<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burak Multiomics - Complete Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&family=Space+Grotesk:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        
        /* Premium scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(15,23,42,0.5);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #60a5fa, #a78bfa);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #3b82f6, #8b5cf6);
        }
        :root {
            --emerald: #34d399; --amber: #fbbf24; --rose: #fb7185;
            --blue: #60a5fa; --purple: #a78bfa; --slate: #0f172a;
            --bg-card: rgba(255,255,255,0.03);
            --border: rgba(255,255,255,0.08);
            --text-primary: #f1f5f9;
            --text-muted: #94a3b8;
        }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #161b2e 50%, #0f1420 100%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-primary); 
            min-height: 100vh; 
            padding: 48px 32px;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(96,165,250,0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(167,139,250,0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(52,211,153,0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .container { max-width: 1600px; margin: 0 auto; position: relative; z-index: 1; }
        .header {
            background: rgba(255,255,255,0.04);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; 
            padding: 36px 48px; 
            margin-bottom: 48px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .brand h1 { 
            font-size: 28px; font-weight: 800; color: #60a5fa; 
            letter-spacing: -0.5px;
        }
        .patient-select {
            padding: 14px 28px; background: rgba(59,130,246,0.08);
            border: 1.5px solid rgba(59,130,246,0.25); border-radius: 12px;
            color: #60a5fa; font-weight: 600; font-size: 13px; cursor: pointer;
            font-family: 'Space Grotesk', sans-serif; transition: all 0.3s;
        }
        .patient-select:hover {
            background: rgba(59,130,246,0.12);
            border-color: rgba(59,130,246,0.4);
        }
        .patient-select option { background: #1a1f2e; color: #ffffff; }
        
        .processing-overlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(10,14,26,0.97);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 9999;
            display: none; 
            align-items: center; 
            justify-content: center;
            flex-direction: column;
        }
        .processing-overlay.active { display: flex; animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .processing-spinner {
            width: 80px; 
            height: 80px; 
            border: 4px solid rgba(96,165,250,0.15);
            border-top: 4px solid #60a5fa; 
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite; 
            margin-bottom: 32px;
            box-shadow: 0 0 30px rgba(96,165,250,0.3);
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .processing-text {
            font-size: 20px; 
            font-weight: 700; 
            color: #60a5fa;
            text-align: center; 
            font-family: 'JetBrains Mono';
            text-shadow: 0 0 20px rgba(96,165,250,0.4);
            letter-spacing: 1px;
        }
        .processing-subtext {
            font-size: 13px; 
            color: #94a3b8; 
            margin-top: 12px;
            font-family: 'JetBrains Mono';
            opacity: 0.8;
        }
        
        .layer-nav {
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 20px; margin-bottom: 48px;
        }
        .layer-btn {
            padding: 24px 20px; background: var(--bg-card);
            border: 1px solid var(--border); border-radius: 16px;
            cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .layer-btn:hover {
            background: rgba(255,255,255,0.04);
            transform: translateY(-2px);
        }
        .layer-btn.active {
            background: rgba(59,130,246,0.1); 
            border-color: rgba(59,130,246,0.4);
            box-shadow: 0 0 30px rgba(59,130,246,0.2);
            animation: activePulse 2s ease-in-out infinite;
        }
        @keyframes activePulse {
            0%, 100% { box-shadow: 0 0 30px rgba(59,130,246,0.2); }
            50% { box-shadow: 0 0 40px rgba(59,130,246,0.35); }
        }
        .layer-btn.locked { opacity: 0.4; cursor: not-allowed; }
        .layer-num { 
            font-size: 10px; color: #60a5fa; font-weight: 900; 
            margin-bottom: 8px; font-family: 'JetBrains Mono'; 
            letter-spacing: 1px;
        }
        .layer-name { font-size: 13px; font-weight: 700; margin-bottom: 8px; }
        .layer-status { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .layer-content { display: none; }
        .layer-content.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Comprehensive Inflammation Container Styles */
        .inflammation-comprehensive {
            background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(239,68,68,0.05));
            border: 3px solid #ef4444; border-radius: 20px; padding: 40px;
            margin-bottom: 32px; box-shadow: 0 0 40px rgba(239,68,68,0.3);
        }
        .inflam-main-header {
            text-align: center; padding-bottom: 24px;
            border-bottom: 2px solid rgba(239,68,68,0.3); margin-bottom: 32px;
        }
        .inflam-main-title {
            font-size: 24px; font-weight: 900; color: #ef4444;
            margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .inflam-subtitle {
            font-size: 13px; color: #fca5a5; font-weight: 700;
        }
        .inflam-section {
            background: rgba(0,0,0,0.4); padding: 28px; border-radius: 16px;
            margin-bottom: 24px; border: 2px solid rgba(239,68,68,0.25);
        }
        .inflam-section-title {
            font-size: 14px; font-weight: 900; color: #fca5a5;
            text-transform: uppercase; margin-bottom: 20px;
            padding-bottom: 12px; border-bottom: 1px solid rgba(239,68,68,0.3);
            letter-spacing: 1px;
        }
        .inflam-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;
        }
        .inflam-grid-2 {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;
        }
        .inflam-marker {
            background: rgba(255,255,255,0.03); padding: 16px; border-radius: 10px;
            border-left: 4px solid;
        }
        .inflam-marker.green { border-color: var(--emerald); }
        .inflam-marker.amber { border-color: var(--amber); }
        .inflam-marker.rose { border-color: var(--rose); }
        .inflam-marker-name { 
            font-size: 10px; font-weight: 900; color: #cbd5e1; 
            text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px;
        }
        .inflam-marker-value {
            font-size: 26px; font-weight: 900; margin-bottom: 4px;
            font-family: 'JetBrains Mono';
        }
        .inflam-marker-value.green { color: var(--emerald); }
        .inflam-marker-value.amber { color: var(--amber); }
        .inflam-marker-value.rose { color: var(--rose); }
        .inflam-marker-unit { font-size: 9px; color: #cbd5e1; font-weight: 700; }
        .inflam-marker-ref { font-size: 8px; color: #94a3b8; font-family: 'JetBrains Mono'; margin-top: 4px; }
        .inflam-state-final {
            background: rgba(0,0,0,0.5); padding: 36px; border-radius: 20px;
            text-align: center; border: 3px solid; margin-top: 28px;
        }
        .inflam-state-final.green { border-color: var(--emerald); }
        .inflam-state-final.amber { border-color: var(--amber); }
        .inflam-state-final.rose { border-color: var(--rose); }
        .inflam-state-label {
            font-size: 11px; font-weight: 900; text-transform: uppercase;
            color: #94a3b8; margin-bottom: 16px;
        }
        .inflam-state-value {
            font-size: 72px; font-weight: 900; line-height: 1; margin-bottom: 12px;
        }
        .inflam-state-value.green { color: var(--emerald); }
        .inflam-state-value.amber { color: var(--amber); }
        .inflam-state-value.rose { color: var(--rose); }
        .inflam-state-score { font-size: 14px; font-weight: 800; text-transform: uppercase; color: #94a3b8; }
        
        .patient-header {
            background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.1));
            border: 1px solid rgba(59,130,246,0.3); border-radius: 16px;
            padding: 40px; margin-bottom: 32px; text-align: center;
        }
        .patient-name {
            font-size: 48px; font-weight: 900;
            background: linear-gradient(135deg, #60a5fa, #a855f7);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .patient-meta { font-size: 14px; color: #94a3b8; font-family: 'JetBrains Mono'; }
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 28px; margin-bottom: 48px; }
        .kpi-card {
            background: var(--bg-card); 
            backdrop-filter: blur(8px);
            border: 2px solid; 
            border-radius: 20px;
            padding: 36px 28px; 
            text-align: center; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.03) 50%,
                rgba(255,255,255,0) 100%
            );
            transform: rotate(45deg);
            animation: shimmer 8s infinite;
            pointer-events: none;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        .kpi-card:hover { 
            transform: translateY(-4px) scale(1.02); 
            box-shadow: 0 12px 40px rgba(0,0,0,0.25);
        }
        .kpi-card.green { 
            border-color: rgba(52,211,153,0.35); 
            background: linear-gradient(135deg, rgba(52,211,153,0.04) 0%, rgba(52,211,153,0.1) 100%);
        }
        .kpi-card.amber { 
            border-color: rgba(251,191,36,0.35); 
            background: linear-gradient(135deg, rgba(251,191,36,0.04) 0%, rgba(251,191,36,0.1) 100%);
        }
        .kpi-card.rose { 
            border-color: rgba(251,113,133,0.35); 
            background: linear-gradient(135deg, rgba(251,113,133,0.04) 0%, rgba(251,113,133,0.1) 100%);
        }
        .kpi-label { 
            font-size: 11px; font-weight: 800; text-transform: uppercase; 
            color: var(--text-muted); margin-bottom: 20px; letter-spacing: 1.5px;
        }
        .kpi-value { 
            font-size: 52px; font-weight: 900; line-height: 1; 
            margin-bottom: 16px; font-family: 'JetBrains Mono';
        }
        .kpi-value.green { color: var(--emerald); }
        .kpi-value.amber { color: var(--amber); }
        .kpi-value.rose { color: var(--rose); }
        .kpi-subtitle { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
        .gcc-section {
            background: var(--bg-card); border: 2px solid; border-radius: 20px;
            padding: 36px; margin-bottom: 48px;
        }
        .gcc-section.green { border-color: rgba(16,185,129,0.3); }
        .gcc-section.amber { border-color: rgba(245,158,11,0.3); }
        .gcc-section.rose { border-color: rgba(239,68,68,0.3); }
        .gcc-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid var(--border);
        }
        .gcc-title { 
            font-size: 15px; font-weight: 800; color: #60a5fa; 
            text-transform: uppercase; letter-spacing: 1.5px;
        }
        .gcc-score-card {
            background: rgba(0,0,0,0.4); padding: 20px 36px; border-radius: 16px;
            border-left: 4px solid; text-align: center;
        }
        .gcc-score-card.green { border-color: var(--emerald); }
        .gcc-score-card.amber { border-color: var(--amber); }
        .gcc-score-card.rose { border-color: var(--rose); }
        .gcc-score-label { font-size: 10px; font-weight: 900; text-transform: uppercase; color: #94a3b8; margin-bottom: 8px; }
        .gcc-score-value { font-size: 48px; font-weight: 900; line-height: 1; margin-bottom: 4px; }
        .gcc-score-value.green { color: var(--emerald); }
        .gcc-score-value.amber { color: var(--amber); }
        .gcc-score-value.rose { color: var(--rose); }
        .gcc-score-grade { font-size: 12px; font-weight: 800; text-transform: uppercase; }
        .gcc-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 20px; }
        .gcc-marker {
            background: rgba(0,0,0,0.25); 
            padding: 24px 18px; 
            border-radius: 12px;
            border: 1px solid; 
            text-align: center; 
            transition: all 0.3s ease;
        }
        .gcc-marker:hover {
            transform: translateY(-2px);
            background: rgba(0,0,0,0.35);
        }
        .gcc-marker.green { border-color: rgba(52,211,153,0.25); background: linear-gradient(135deg, rgba(52,211,153,0.05), rgba(52,211,153,0.02)); }
        .gcc-marker.amber { border-color: rgba(251,191,36,0.25); background: linear-gradient(135deg, rgba(251,191,36,0.05), rgba(251,191,36,0.02)); }
        .gcc-marker.rose { border-color: rgba(251,113,133,0.25); background: linear-gradient(135deg, rgba(251,113,133,0.05), rgba(251,113,133,0.02)); }
        .gcc-marker-name { 
            font-size: 11px; 
            font-weight: 800; 
            color: #cbd5e1; 
            margin-bottom: 14px; 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }
        .gcc-marker-value { 
            font-size: 32px; 
            font-weight: 900; 
            margin-bottom: 8px; 
            font-family: 'JetBrains Mono';
            letter-spacing: -1px;
        }
        .gcc-marker-value.green { color: var(--emerald); }

        .gcc-marker-value.amber { color: var(--amber); }
        .gcc-marker-value.rose { color: var(--rose); }
        .gcc-marker-unit { font-size: 10px; color: #cbd5e1; font-weight: 700; }
        .blobs-section { margin-bottom: 32px; }
        .blobs-title { font-size: 20px; font-weight: 900; color: #60a5fa; margin-bottom: 24px; text-transform: uppercase; }
        .blobs-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 20px; }
        .blob { 
            background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 14px; 
            padding: 24px; 
            transition: all 0.3s ease;
        }
        .blob:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.12);
            transform: translateY(-2px);
        }
        .blob-header { text-align: center; padding-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 16px; }
        .blob-icon { font-size: 32px; margin-bottom: 8px; }
        .blob-name { font-size: 11px; font-weight: 900; text-transform: uppercase; color: #cbd5e1; letter-spacing: 0.5px; }
        .marker-item {
            background: rgba(255,255,255,0.025); 
            padding: 14px 12px; 
            border-radius: 10px;
            margin-bottom: 10px; 
            border: 1px solid;
            transition: all 0.2s ease;
        }
        .marker-item:hover {
            background: rgba(255,255,255,0.04);
            transform: translateX(2px);
        }
        .marker-item.green { border-color: rgba(52,211,153,0.3); }
        .marker-item.amber { border-color: rgba(251,191,36,0.3); }
        .marker-item.rose { border-color: rgba(251,113,133,0.3); }
        .marker-name { 
            font-size: 10px; 
            font-weight: 800; 
            color: #cbd5e1; 
            margin-bottom: 8px; 
            text-transform: uppercase; 
            letter-spacing: 0.8px;
        }
        .marker-value { 
            font-size: 24px; 
            font-weight: 900; 
            margin-bottom: 4px; 
            font-family: 'JetBrains Mono';
            letter-spacing: -0.5px;
        }
        .marker-value.green { color: var(--emerald); }
        .marker-value.amber { color: var(--amber); }
        .marker-value.rose { color: var(--rose); }
        .marker-unit { 
            font-size: 10px; 
            color: #94a3b8; 
            font-weight: 600;
            margin-left: 4px;
        }
        .marker-ref { 
            font-size: 9px; 
            margin-top: 6px; 
            padding: 5px 8px; 
            border-radius: 6px; 
            font-family: 'JetBrains Mono';
            display: inline-block; 
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        .marker-ref.green { background: rgba(52,211,153,0.12); color: #6ee7b7; border: 1px solid rgba(52,211,153,0.3); }
        .marker-ref.amber { background: rgba(251,191,36,0.12); color: #fcd34d; border: 1px solid rgba(251,191,36,0.3); }
        .marker-ref.rose { background: rgba(239,68,68,0.2); color: var(--rose); border: 1px solid var(--rose); }
        .phyla-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 24px; margin-top: 40px; }
        .phyla-card { 
            background: var(--bg-card); border: 1.5px solid var(--border); 
            padding: 28px 24px; border-radius: 20px; text-align: center; 
            transition: all 0.3s;
        }
        .phyla-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }
        .phyla-circle {
            width: 90px; height: 90px; margin: 0 auto 12px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; font-weight: 900; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .phyla-name { 
            font-size: 13px; font-weight: 900; margin-bottom: 6px; 
            letter-spacing: 0.3px; color: #e2e8f0;
        }
        .phyla-role { font-size: 10px; color: #cbd5e1; font-weight: 700; }
        
        /* Sentinel Analysis Styles */
        .sentinel-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 32px; }
        .sentinel-card {
            background: var(--bg-card); border: 2px solid; padding: 40px 36px; 
            border-radius: 20px; transition: all 0.3s;
        }
        .sentinel-card:hover {
            transform: translateY(-3px);
        }
        .sentinel-card.green { 
            border-color: rgba(16,185,129,0.3); 
            background: linear-gradient(135deg, rgba(16,185,129,0.03) 0%, rgba(16,185,129,0.08) 100%);
        }
        .sentinel-card.amber { 
            border-color: rgba(245,158,11,0.3); 
            background: linear-gradient(135deg, rgba(245,158,11,0.03) 0%, rgba(245,158,11,0.08) 100%);
        }
        .sentinel-card.rose { 
            border-color: rgba(239,68,68,0.3); 
            background: linear-gradient(135deg, rgba(239,68,68,0.03) 0%, rgba(239,68,68,0.08) 100%);
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); } 50% { box-shadow: 0 0 0 20px rgba(239,68,68,0); } }
        .sentinel-header { 
            text-align: center; padding-bottom: 24px; 
            border-bottom: 1px solid var(--border); margin-bottom: 28px; 
        }
        .sentinel-label { 
            font-size: 11px; font-weight: 800; text-transform: uppercase; 
            color: var(--text-muted); margin-bottom: 20px; 
            font-family: 'JetBrains Mono'; letter-spacing: 1.5px;
        }
        .sentinel-status { 
            font-size: 30px; font-weight: 900; margin-bottom: 12px; 
            font-family: 'JetBrains Mono';
        }
        .sentinel-status.green { color: var(--emerald); }
        .sentinel-status.amber { color: var(--amber); }
        .sentinel-status.rose { color: var(--rose); }
        .sentinel-verdict { font-size: 13px; font-weight: 800; text-transform: uppercase; color: #94a3b8; }
        .sentinel-details { display: grid; gap: 12px; }
        .sentinel-marker {
            background: rgba(0,0,0,0.3); padding: 16px; border-radius: 8px;
            display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 16px;
        }
        .sentinel-marker-name { font-size: 10px; font-weight: 900; text-transform: uppercase; color: #94a3b8; margin-bottom: 4px; }
        .sentinel-marker-reason { font-size: 11px; color: #cbd5e1; line-height: 1.5; }
        .sentinel-marker-value { font-size: 36px; font-weight: 900; text-align: right; }
        .sentinel-marker-value.green { color: var(--emerald); }
        .sentinel-marker-value.amber { color: var(--amber); }
        .sentinel-marker-value.rose { color: var(--rose); }
        
        /* Sentinel Analysis Styles */
        .sentinel-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        .sentinel-card {
            background: rgba(255,255,255,0.02); border: 3px solid; padding: 32px; border-radius: 16px;
        }
        .sentinel-card.green { border-color: var(--emerald); background: rgba(16,185,129,0.05); }
        .sentinel-card.amber { border-color: var(--amber); background: rgba(245,158,11,0.05); }
        .sentinel-card.rose { border-color: var(--rose); background: rgba(239,68,68,0.05); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); } 50% { box-shadow: 0 0 0 20px rgba(239,68,68,0); } }
        .sentinel-header { text-align: center; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 24px; }
        .sentinel-label { font-size: 11px; font-weight: 900; text-transform: uppercase; color: #94a3b8; margin-bottom: 16px; font-family: 'JetBrains Mono'; }
        .sentinel-status { font-size: 32px; font-weight: 900; margin-bottom: 8px; }
        .sentinel-status.green { color: var(--emerald); }
        .sentinel-status.amber { color: var(--amber); }
        .sentinel-status.rose { color: var(--rose); }
        .sentinel-verdict { font-size: 13px; font-weight: 800; text-transform: uppercase; color: #94a3b8; }
        .sentinel-details { display: grid; gap: 12px; }
        .sentinel-marker {
            background: rgba(0,0,0,0.3); padding: 16px; border-radius: 8px;
            display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 16px;
        }
        .sentinel-marker-name { font-size: 10px; font-weight: 900; text-transform: uppercase; color: #94a3b8; margin-bottom: 4px; }
        .sentinel-marker-reason { font-size: 11px; color: #cbd5e1; line-height: 1.5; }
        .sentinel-marker-value { font-size: 36px; font-weight: 900; text-align: right; }
        .sentinel-marker-value.green { color: var(--emerald); }
        .sentinel-marker-value.amber { color: var(--amber); }
        .sentinel-marker-value.rose { color: var(--rose); }
        
        /* Cohort Matrix Styles */
        .cohort-grid { display: grid; gap: 28px; }
        .cohort-card { 
            background: var(--bg-card); 
            border: 1px solid; 
            border-radius: 16px; 
            overflow: hidden; 
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .cohort-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        .cohort-card.optimal { border-color: rgba(52,211,153,0.25); background: linear-gradient(135deg, rgba(52,211,153,0.03), rgba(52,211,153,0.01)); }
        .cohort-card.low { border-color: rgba(100,116,139,0.25); background: linear-gradient(135deg, rgba(100,116,139,0.03), rgba(100,116,139,0.01)); }
        .cohort-card.medium { border-color: rgba(251,191,36,0.25); background: linear-gradient(135deg, rgba(251,191,36,0.03), rgba(251,191,36,0.01)); }
        .cohort-card.high { border-color: rgba(251,113,133,0.25); background: linear-gradient(135deg, rgba(251,113,133,0.03), rgba(251,113,133,0.01)); }
        .cohort-main { 
            padding: 28px; 
            display: grid; 
            grid-template-columns: 50px 1fr auto; 
            gap: 24px; 
            align-items: center; 
        }
        .cohort-icon { font-size: 36px; opacity: 0.9; }
        .cohort-info h3 { 
            font-size: 17px; 
            font-weight: 800; 
            margin-bottom: 8px; 
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }
        .cohort-markers { 
            font-size: 11px; 
            color: #94a3b8; 
            font-family: 'JetBrains Mono'; 
            line-height: 1.6;
            letter-spacing: 0.3px;
        }
        .cohort-percent { 
            font-size: 44px; 
            font-weight: 900; 
            text-align: center;
            letter-spacing: -2px;
        }
        .cohort-percent.optimal { color: var(--emerald); }
        .cohort-percent.low { color: #94a3b8; }
        .cohort-percent.medium { color: var(--amber); }
        .cohort-percent.high { color: var(--rose); }
        .cohort-label { 
            font-size: 10px; 
            text-transform: uppercase; 
            font-weight: 700; 
            color: #94a3b8; 
            text-align: center;
            letter-spacing: 1px;
        }
        .cohort-status { 
            font-size: 11px; 
            font-weight: 800; 
            margin-top: 6px; 
            text-align: center;
            letter-spacing: 0.5px;
        }
        .cohort-deep-dive {
            background: rgba(0,0,0,0.2); 
            border-top: 1px solid rgba(255,255,255,0.08); 
            padding: 24px;
        }
        .deep-dive-title { 
            font-size: 12px; 
            font-weight: 900; 
            color: #60a5fa; 
            margin-bottom: 18px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .math-breakdown { display: grid; gap: 10px; }
        .math-row {
            display: grid; 
            grid-template-columns: 200px 1fr auto; 
            gap: 16px; 
            align-items: center;
            padding: 12px 14px; 
            background: rgba(255,255,255,0.03); 
            border-radius: 8px;
            font-family: 'JetBrains Mono'; 
            font-size: 11px;
            transition: background 0.2s ease;
        }
        .math-row:hover {
            background: rgba(255,255,255,0.05);
        }
        .math-condition { color: #cbd5e1; font-weight: 500; }
        .math-logic { color: #94a3b8; font-size: 10px; }
        .math-score { font-weight: 900; text-align: right; font-size: 13px; }
        .math-score.green { color: var(--emerald); }
        .math-score.amber { color: var(--amber); }
        .math-score.rose { color: var(--rose); }
        .math-total {
            border-top: 2px solid rgba(255,255,255,0.15); 
            padding-top: 16px;
            margin-top: 12px; 
            font-size: 13px; 
            font-weight: 900; 
            text-align: center;
            letter-spacing: 0.5px;
        }
        
        /* Handshake Pathways Styles */
        .terminal {
            background: #000; border: 1px solid #333; border-radius: 8px; padding: 16px;
            font-family: 'JetBrains Mono'; font-size: 11px; color: #0f0;
            margin-bottom: 24px; max-height: 200px; overflow-y: auto;
        }
        .terminal-line { margin-bottom: 4px; }
        .terminal-prompt { color: #60a5fa; }
        .terminal-success { color: #10b981; }
        .handshake-visual {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 40px; margin-bottom: 24px;
        }
        .scan-header { text-align: center; margin-bottom: 32px; }
        .scan-title { font-size: 24px; font-weight: 900; color: #ec4899; margin-bottom: 8px; }
        .scan-subtitle { font-size: 12px; color: #94a3b8; }
        .blob-scanner { display: grid; grid-template-columns: 1fr auto 1fr; gap: 40px; align-items: center; margin-bottom: 32px; }
        .blob-visual {
            background: rgba(255,255,255,0.02); border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 28px; text-align: center;
        }
        .blob-visual-icon { font-size: 64px; margin-bottom: 16px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .blob-visual-label { font-size: 10px; font-weight: 900; text-transform: uppercase; color: #a855f7; margin-bottom: 12px; }
        .blob-visual-name { font-size: 14px; font-weight: 700; margin-bottom: 12px; }
        .blob-visual-value { font-size: 40px; font-weight: 900; }
        .blob-visual-value.green { color: var(--emerald); }
        .blob-visual-value.amber { color: var(--amber); }
        .blob-visual-value.rose { color: var(--rose); }
        .connector-arrow { font-size: 48px; color: #ec4899; text-align: center; animation: pulse-arrow 1.5s ease-in-out infinite; }
        @keyframes pulse-arrow { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
        .connector-label { font-size: 10px; font-weight: 900; text-transform: uppercase; color: #94a3b8; text-align: center; }
        .scan-data {
            background: rgba(59,130,246,0.05); border: 1px solid rgba(59,130,246,0.2);
            padding: 20px; border-radius: 12px;
        }
        .scan-data-title { font-size: 12px; font-weight: 900; color: #60a5fa; margin-bottom: 12px; text-transform: uppercase; }
        .scan-data-text { font-size: 12px; line-height: 1.8; color: #cbd5e1; }
        
        .diagnostic-sheet { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 32px; }
        .diagnostic-header { text-align: center; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .diagnostic-title { font-size: 28px; font-weight: 900; margin-bottom: 8px; }
        .diagnostic-title.sovereignty { color: var(--emerald); }
        .diagnostic-title.decoherence { color: var(--rose); }
        .diagnostic-subtitle { font-size: 12px; color: #64748b; }
        
        /* AI Diagnostic Report Styles */
        .diagnostic-report { background: var(--bg-card); border: 2px solid var(--border); border-radius: 20px; padding: 40px; }
        .diag-header { text-align: center; padding: 32px; border-radius: 16px; margin-bottom: 32px; border: 2px solid; }
        .diag-header.green { border-color: rgba(16,185,129,0.3); background: linear-gradient(135deg, rgba(16,185,129,0.05), rgba(16,185,129,0.1)); }
        .diag-header.amber { border-color: rgba(245,158,11,0.3); background: linear-gradient(135deg, rgba(245,158,11,0.05), rgba(245,158,11,0.1)); }
        .diag-header.rose { border-color: rgba(239,68,68,0.3); background: linear-gradient(135deg, rgba(239,68,68,0.05), rgba(239,68,68,0.1)); }
        .diag-patient { font-size: 24px; font-weight: 900; margin-bottom: 12px; }
        .diag-status { font-size: 16px; font-weight: 800; margin-bottom: 8px; letter-spacing: 1px; }
        .diag-case { font-size: 12px; color: var(--text-muted); font-weight: 600; }
        .diag-section { background: rgba(0,0,0,0.2); padding: 28px; border-radius: 16px; margin-bottom: 24px; border: 1px solid var(--border); }
        .diag-section-title { font-size: 14px; font-weight: 900; color: #60a5fa; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 1px; }
        .diag-kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .diag-kpi { background: rgba(0,0,0,0.3); padding: 24px; border-radius: 12px; text-align: center; border: 2px solid; }
        .diag-kpi.green { border-color: rgba(16,185,129,0.3); }
        .diag-kpi.amber { border-color: rgba(245,158,11,0.3); }
        .diag-kpi.rose { border-color: rgba(239,68,68,0.3); }
        .diag-kpi-label { font-size: 10px; font-weight: 800; color: var(--text-muted); margin-bottom: 12px; letter-spacing: 1px; }
        .diag-kpi-value { font-size: 32px; font-weight: 900; margin-bottom: 8px; font-family: 'JetBrains Mono'; }
        .diag-kpi.green .diag-kpi-value { color: var(--emerald); }
        .diag-kpi.amber .diag-kpi-value { color: var(--amber); }
        .diag-kpi.rose .diag-kpi-value { color: var(--rose); }
        .diag-kpi-sub { font-size: 11px; color: #cbd5e1; line-height: 1.5; }
        .diag-risk-summary { font-size: 14px; font-weight: 700; padding: 16px; border-radius: 10px; margin-bottom: 20px; }
        .diag-risk-summary.green { background: rgba(16,185,129,0.1); color: var(--emerald); }
        .diag-risk-summary.amber { background: rgba(245,158,11,0.1); color: var(--amber); }
        .diag-risk-summary.rose { background: rgba(239,68,68,0.1); color: var(--rose); }
        .diag-risk-list { margin-top: 16px; }
        .diag-risk-label { font-size: 11px; font-weight: 800; color: var(--text-muted); margin-bottom: 12px; letter-spacing: 0.5px; }
        .diag-risk-item { padding: 12px 16px; border-radius: 8px; margin-bottom: 8px; font-size: 12px; font-weight: 700; }
        .diag-risk-item.rose { background: rgba(239,68,68,0.1); color: #fca5a5; border-left: 3px solid var(--rose); }
        .diag-risk-item.amber { background: rgba(245,158,11,0.1); color: #fbbf24; border-left: 3px solid var(--amber); }
        .diag-findings { display: flex; flex-direction: column; gap: 12px; }
        .diag-finding { padding: 14px 18px; border-radius: 10px; font-size: 13px; line-height: 1.6; border-left: 4px solid; }
        .diag-finding.green { background: rgba(16,185,129,0.08); color: #cbd5e1; border-color: var(--emerald); }
        .diag-finding.amber { background: rgba(245,158,11,0.08); color: #cbd5e1; border-color: var(--amber); }
        .diag-finding.rose { background: rgba(239,68,68,0.08); color: #cbd5e1; border-color: var(--rose); }
        .diag-recommendations { display: flex; flex-direction: column; gap: 14px; }
        .diag-rec { padding: 16px 20px; background: rgba(59,130,246,0.08); border-radius: 10px; font-size: 13px; color: #cbd5e1; line-height: 1.7; border-left: 4px solid rgba(59,130,246,0.4); }
        .diag-footer { margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center; }
        
        .btn {
            padding: 14px 32px; border: none; border-radius: 8px; font-size: 11px;
            font-weight: 900; text-transform: uppercase; letter-spacing: 2px;
            cursor: pointer; transition: all 0.3s; font-family: 'JetBrains Mono';
        }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; box-shadow: 0 4px 12px rgba(59,130,246,0.3); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(59,130,246,0.5); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(59,130,246,0.4); }
        .btn-secondary { background: linear-gradient(135deg, #64748b, #475569); color: white; box-shadow: 0 4px 12px rgba(100,116,139,0.3); }
        .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(100,116,139,0.4); }
        .hidden { display: none !important; }
        .alert {
            padding: 20px 28px; border-radius: 16px; margin-bottom: 28px;
            font-size: 12px; font-weight: 600; border: 1px solid;
            background: var(--bg-card);
        }
        .alert.info { 
            background: rgba(59,130,246,0.06); 
            border-color: rgba(59,130,246,0.25); 
            color: #93c5fd; 
        }
        .alert.warning {
            background: rgba(245,158,11,0.06);
            border-color: rgba(245,158,11,0.25);
            color: #fbbf24;
        }
        .text-center { text-align: center; }
        .mb-4 { margin-bottom: 32px; }
        .footer { 
            text-align: center; padding: 48px; 
            color: var(--text-muted); font-size: 11px; 
            margin-top: 64px; letter-spacing: 0.5px;
        }
        
        /* Layer 7: Advanced Analytics Styles */
        .analytics-module {
            background: var(--bg-card); border: 2px solid var(--border);
            border-radius: 20px; padding: 40px; margin-bottom: 32px;
        }
        .analytics-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 28px; padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }
        .analytics-title {
            font-size: 20px; font-weight: 900; color: #60a5fa;
            letter-spacing: -0.3px;
        }
        .analytics-badge {
            padding: 8px 16px; background: rgba(16,185,129,0.1);
            border: 1px solid rgba(16,185,129,0.3); border-radius: 8px;
            font-size: 10px; font-weight: 700; color: #10b981;
            letter-spacing: 0.5px; text-transform: uppercase;
        }
        .score-ring {
            position: relative; width: 180px; height: 180px;
            margin: 0 auto; display: flex; align-items: center;
            justify-content: center;
        }
        .ring-svg {
            position: absolute; width: 100%; height: 100%;
            transform: rotate(-90deg);
        }
        .ring-bg {
            fill: none; stroke: rgba(255,255,255,0.05); stroke-width: 10;
        }
        .ring-progress {
            fill: none; stroke-width: 10; stroke-linecap: round;
            transition: stroke-dashoffset 1.5s ease;
        }
        .ring-content {
            position: relative; text-align: center;
        }
        .ring-score {
            font-size: 42px; font-weight: 900; font-family: 'JetBrains Mono';
        }
        .ring-label {
            font-size: 11px; color: var(--text-muted); font-weight: 600;
            margin-top: 8px; letter-spacing: 0.5px;
        }
        .ring-status {
            font-size: 9px; font-weight: 800; margin-top: 6px;
            padding: 4px 8px; border-radius: 4px; display: inline-block;
            letter-spacing: 0.5px;
        }
        .ring-status.green { background: rgba(16,185,129,0.15); color: var(--emerald); }
        .ring-status.amber { background: rgba(245,158,11,0.15); color: var(--amber); }
        .ring-status.rose { background: rgba(239,68,68,0.15); color: var(--rose); }
        .ring-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 40px; padding: 20px;
        }
        .metric-card {
            background: rgba(0,0,0,0.3); border-radius: 12px;
            padding: 24px; border: 2px solid rgba(255,255,255,0.05);
        }
        .metric-title {
            font-size: 12px; color: var(--text-muted); font-weight: 700;
            margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .metric-value {
            font-size: 32px; font-weight: 900; font-family: 'JetBrains Mono';
            margin-bottom: 8px;
        }
        .metric-status {
            font-size: 11px; font-weight: 600;
        }
        
        /* WOW FACTOR ADDITIONS - Network Graph */
        .network-container {
            background: rgba(0,0,0,0.3); border-radius: 16px;
            padding: 40px; min-height: 600px; position: relative;
            overflow: hidden;
        }
        .network-node {
            position: absolute; width: 80px; height: 80px;
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 9px; font-weight: 700;
            text-align: center; padding: 8px; cursor: pointer;
            transition: all 0.3s; border: 3px solid;
            user-select: none;
        }
        .network-node:hover {
            transform: scale(1.2); z-index: 100;
            box-shadow: 0 0 30px rgba(96,165,250,0.5);
        }
        .network-node.active {
            transform: scale(1.3); z-index: 101;
            box-shadow: 0 0 40px rgba(96,165,250,0.8);
        }
        .network-edge {
            position: absolute; height: 2px; background: rgba(255,255,255,0.1);
            transform-origin: left center; pointer-events: none;
            transition: all 0.3s;
        }
        .network-edge.strong { 
            background: rgba(96,165,250,0.4); height: 3px; 
        }
        .network-edge.active {
            background: rgba(96,165,250,0.8); height: 4px;
        }
        .network-legend {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0,0,0,0.6); padding: 16px; border-radius: 12px;
            font-size: 11px;
        }
        .legend-item {
            display: flex; align-items: center; gap: 8px; margin-bottom: 8px;
        }
        .legend-dot {
            width: 12px; height: 12px; border-radius: 50%;
        }
        
        /* WOW FACTOR - What-If Simulator */
        .simulator-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 40px;
        }
        .simulator-panel {
            background: rgba(0,0,0,0.3); border-radius: 16px; padding: 32px;
        }
        .simulator-panel h3 {
            font-size: 16px; font-weight: 900; color: #60a5fa;
            margin-bottom: 24px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .slider-group {
            margin-bottom: 24px; padding-bottom: 24px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .slider-label {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px;
        }
        .slider-name {
            font-size: 13px; font-weight: 700; color: var(--text-primary);
        }
        .slider-value {
            font-size: 14px; font-weight: 900; font-family: 'JetBrains Mono';
            color: #60a5fa;
        }
        .slider {
            width: 100%; height: 8px; border-radius: 4px;
            background: rgba(255,255,255,0.1); appearance: none;
            outline: none; cursor: pointer;
        }
        .slider::-webkit-slider-thumb {
            appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: #60a5fa;
            cursor: pointer; box-shadow: 0 0 10px rgba(96,165,250,0.5);
        }
        .sim-result-card {
            background: rgba(59,130,246,0.05); border: 2px solid rgba(59,130,246,0.2);
            border-radius: 12px; padding: 24px; margin-bottom: 16px;
        }
        .sim-result-label {
            font-size: 12px; color: var(--text-muted); margin-bottom: 8px;
        }
        .sim-result-value {
            font-size: 36px; font-weight: 900; font-family: 'JetBrains Mono';
        }
        .sim-buttons {
            display: flex; gap: 12px; margin-top: 24px;
        }
        .sim-btn {
            flex: 1; padding: 12px; background: rgba(59,130,246,0.1);
            border: 1px solid rgba(59,130,246,0.3); border-radius: 8px;
            color: #60a5fa; font-weight: 700; font-size: 11px;
            cursor: pointer; transition: all 0.3s;
        }
        .sim-btn:hover {
            background: rgba(59,130,246,0.2);
            transform: translateY(-2px);
        }
        
        /* WOW FACTOR - Inflammation Dashboard */
        .inflam-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;
        }
        .inflam-card {
            background: rgba(239,68,68,0.05); border: 2px solid rgba(239,68,68,0.2);
            border-radius: 16px; padding: 24px;
        }
        .inflam-card-title {
            font-size: 12px; font-weight: 700; color: #fca5a5;
            margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .inflam-value {
            font-size: 32px; font-weight: 900; font-family: 'JetBrains Mono';
            color: #ef4444; margin-bottom: 12px;
        }
        .inflam-status {
            font-size: 11px; font-weight: 700; padding: 6px 12px;
            border-radius: 6px; display: inline-block;
        }
        .inflam-status.green {
            background: rgba(16,185,129,0.15);
            color: var(--emerald);
        }
        .inflam-status.amber {
            background: rgba(245,158,11,0.15);
            color: var(--amber);
        }
        .inflam-status.rose {
            background: rgba(239,68,68,0.15);
            color: var(--rose);
        }
        .inflam-bar {
            height: 8px; background: rgba(255,255,255,0.1);
            border-radius: 4px; margin-top: 12px; overflow: hidden;
        }
        .inflam-bar-fill {
            height: 100%; background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
            transition: width 1s ease;
        }
        
        /* CORE METRICS GRID - Clean, Focused, Large Cards */
        .core-metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }
        .core-metric-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }
        .core-metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.3);
        }
        .core-metric-title {
            font-size: 13px;
            font-weight: 800;
            color: var(--text-muted);
            margin-bottom: 20px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .core-metric-value {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 12px;
            font-family: 'JetBrains Mono';
        }
        .core-metric-value.green { color: var(--emerald); }
        .core-metric-value.amber { color: var(--amber); }
        .core-metric-value.rose { color: var(--rose); }
        .core-metric-status {
            font-size: 14px;
            font-weight: 700;
            padding: 10px 16px;
            border-radius: 8px;
            display: inline-block;
        }
        .core-metric-status.green {
            background: rgba(16,185,129,0.15);
            color: var(--emerald);
        }
        .core-metric-status.amber {
            background: rgba(245,158,11,0.15);
            color: var(--amber);
        }
        .core-metric-status.rose {
            background: rgba(239,68,68,0.15);
            color: var(--rose);
        }
        .core-metric-description {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 16px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="processing-overlay" id="processing-overlay">
        <div class="processing-spinner"></div>
        <div class="processing-text" id="processing-text">PROCESSING...</div>
        <div class="processing-subtext" id="processing-subtext">Analyzing multi-omic data</div>
    </div>

    <div class="container">
        <header class="header">
            <div class="brand">
                <h1>ðŸ”¬ BURAK MULTIOMICS</h1>
            </div>
            <select class="patient-select" id="patient-select" onchange="loadPatient()"></select>
        </header>

        <div class="layer-nav">
            <div class="layer-btn active" onclick="switchLayer(1)">
                <div class="layer-num">LAYER 01</div><div class="layer-name">ðŸ“Š Clinical Lake</div><div class="layer-status">Foundation</div>
            </div>
            <div class="layer-btn locked" id="layer2-btn" onclick="switchLayer(2)">
                <div class="layer-num">LAYER 02</div><div class="layer-name">ðŸ”¥ Inflammation</div><div class="layer-status" id="layer2-status">Locked</div>
            </div>
            <div class="layer-btn locked" id="layer3-btn" onclick="switchLayer(3)">
                <div class="layer-num">LAYER 03</div><div class="layer-name">ðŸŽ¯ Sentinel</div><div class="layer-status" id="layer3-status">Locked</div>
            </div>
            <div class="layer-btn locked" id="layer4-btn" onclick="switchLayer(4)">
                <div class="layer-num">LAYER 04</div><div class="layer-name">ðŸ§¬ Cohort Matrix</div><div class="layer-status" id="layer4-status">Locked</div>
            </div>
            <div class="layer-btn locked" id="layer5-btn" onclick="switchLayer(5)">
                <div class="layer-num">LAYER 05</div><div class="layer-name">ðŸ¤ Handshakes</div><div class="layer-status" id="layer5-status">Locked</div>
            </div>
            <div class="layer-btn locked" id="layer6-btn" onclick="switchLayer(6)">
                <div class="layer-num">LAYER 06</div><div class="layer-name">âš¡ Advanced Analytics</div><div class="layer-status" id="layer6-status">Locked</div>
            </div>
            <div class="layer-btn locked" id="layer7-btn" onclick="switchLayer(7)">
                <div class="layer-num">LAYER 07</div><div class="layer-name">ðŸŽ“ AI Diagnostic</div><div class="layer-status" id="layer7-status">Locked</div>
            </div>
        </div>

        <div class="layer-content active" id="layer1">
            <div style="margin-bottom:24px; padding:24px; background:linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.1)); border-radius:16px; border:2px solid rgba(99,102,241,0.3);">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
                    <div style="font-size:14px; font-weight:900; color:#818cf8; letter-spacing:1px;">ðŸ“¥ LAYER 01: CLINICAL DATA LAKE</div>
                    <div style="font-size:11px; font-weight:700; color:#94a3b8; background:rgba(99,102,241,0.15); padding:6px 12px; border-radius:6px;">MULTI-OMICS FOUNDATION</div>
                </div>
                
                <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:16px; margin-bottom:16px;">
                    <div style="padding:16px; background:rgba(59,130,246,0.08); border-radius:10px; border-left:3px solid #3b82f6;">
                        <div style="font-size:10px; color:#94a3b8; margin-bottom:6px; font-weight:700; letter-spacing:0.5px;">METABOLOMICS</div>
                        <div style="font-size:24px; font-weight:900; color:#60a5fa; margin-bottom:4px;">27</div>
                        <div style="font-size:10px; color:#cbd5e1; line-height:1.4;">Blood chemistry markers (glucose, lipids, liver, kidney, vitamins)</div>
                    </div>
                    
                    <div style="padding:16px; background:rgba(239,68,68,0.08); border-radius:10px; border-left:3px solid #ef4444;">
                        <div style="font-size:10px; color:#94a3b8; margin-bottom:6px; font-weight:700; letter-spacing:0.5px;">PROTEOMICS + CELLULAR</div>
                        <div style="font-size:24px; font-weight:900; color:#f87171; margin-bottom:4px;">9</div>
                        <div style="font-size:10px; color:#cbd5e1; line-height:1.4;">Inflammatory proteins & immune cells (cytokines, neutrophils, platelets)</div>
                    </div>
                    
                    <div style="padding:16px; background:rgba(16,185,129,0.08); border-radius:10px; border-left:3px solid #10b981;">
                        <div style="font-size:10px; color:#94a3b8; margin-bottom:6px; font-weight:700; letter-spacing:0.5px;">METAGENOMICS</div>
                        <div style="font-size:24px; font-weight:900; color:#34d399; margin-bottom:4px;">5</div>
                        <div style="font-size:10px; color:#cbd5e1; line-height:1.4;">Gut phyla composition (Firmicutes, Bacteroides, Akkermansia, etc.)</div>
                    </div>
                </div>
                
                <div style="padding:12px 16px; background:rgba(139,92,246,0.08); border-radius:8px; border-left:3px solid #8b5cf6;">
                    <div style="font-size:11px; color:#c4b5fd; line-height:1.6;">
                        <strong>Total: 41 biomarkers</strong> integrated across 3 biological layers to reveal metabolic state, inflammatory burden, and microbiome health
                    </div>
                </div>
            </div>
            <div class="patient-header" id="patient-header"></div>
            <div class="kpi-grid" id="kpi-grid"></div>
            <div id="gcc-section"></div>
            <div class="blobs-section"><div class="blobs-title">ðŸ“Š MARKER CATEGORIES</div><div class="blobs-grid" id="blobs-grid"></div></div>
            <div class="blobs-section">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:20px;">
                    <div class="blobs-title">ðŸ¦  GUT PHYLA MICROBIAL ENGINE</div>
                    <div style="font-size:9px; font-weight:700; color:var(--text-muted); background:rgba(16,185,129,0.15); padding:6px 12px; border-radius:6px; letter-spacing:0.5px;">METAGENOMICS</div>
                </div>
                <div class="phyla-grid" id="phyla-grid"></div>
            </div>
            <div class="text-center mb-4"><button class="btn btn-primary" onclick="analyzeInflammation()">ðŸ”¥ ANALYZE INFLAMMATION CONTAINER â†’</button></div>
        </div>

        <div class="layer-content" id="layer2">
            <div class="alert info">
                <div><strong>ðŸ”¥ LAYER 02: INFLAMMATION CONTAINER</strong> - Comprehensive inflammation analysis with cytokines, cellular markers, and calculated ratios.</div>
            </div>
            <div id="layer2-content"></div>
            <div class="text-center" style="margin-top: 48px; margin-bottom: 48px;"><button class="btn btn-primary" onclick="analyzeSentinel()">ðŸŽ¯ ANALYZE SENTINEL MARKERS â†’</button></div>
        </div>

        <div class="layer-content" id="layer3">
            <div class="alert info"><strong>ðŸ” LAYER 03: SENTINEL ANALYSIS</strong> - Critical inflammation and stress marker monitoring (CRP, Ferritin, Cortisol).</div>
            <div class="sentinel-grid" id="sentinel-grid"></div>
            <div class="text-center mb-4"><button class="btn btn-primary" onclick="analyzeCohorts()">ðŸ§¬ ANALYZE COHORT MATRIX â†’</button></div>
        </div>

        <div class="layer-content" id="layer4">
            <div class="alert warning"><strong>ðŸ“Š LAYER 04: COHORT MATRIX</strong> - Disease pattern matching across 9 clinical cohorts with mathematical scoring.</div>
            <div class="cohort-grid" id="cohort-grid"></div>
            <div class="text-center mb-4"><button class="btn btn-primary" onclick="analyzeHandshakes()">ðŸ¤ ANALYZE HANDSHAKE PATHWAYS â†’</button></div>
        </div>

        <div class="layer-content" id="layer5">
            <div class="alert info"><strong>ðŸ”— LAYER 05: HANDSHAKE PATHWAYS</strong> - Six 3-way gut-blood correlation cascades showing mechanistic connections.</div>
            <div class="terminal" id="terminal"></div>
            <div id="handshake-container"></div>
            <div class="text-center mb-4"><button class="btn btn-primary" onclick="unlockLayer(6)">âš¡ UNLOCK ADVANCED ANALYTICS â†’</button></div>
        </div>

        <div class="layer-content" id="layer6">
            <div style="margin-bottom:24px; padding:18px 24px; background:linear-gradient(135deg, rgba(139,92,246,0.1), rgba(59,130,246,0.1)); border-radius:12px; border:1px solid rgba(139,92,246,0.2);">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
                    <div style="font-size:13px; font-weight:800; color:#a78bfa; letter-spacing:0.5px;">ðŸ§¬ MULTI-OMICS ADVANCED ANALYTICS</div>
                    <div style="font-size:11px; color:#94a3b8;">Metabolomics â€¢ Proteomics â€¢ Metagenomics</div>
                </div>
                <div style="font-size:11px; color:#cbd5e1; line-height:1.6;">
                    Integrating <strong style="color:#60a5fa;">27 metabolites</strong>, <strong style="color:#ef4444;">10 protein markers</strong>, and <strong style="color:#10b981;">5 gut phyla</strong> for comprehensive health assessment
                </div>
            </div>
            
            <!-- Score Rings -->
            <div class="analytics-module">
                <div class="module-header">
                    <div class="module-title">ðŸŽ¯ Health Scores <span style="font-size:10px; color:var(--text-muted); font-weight:600; margin-left:12px;">METABOLOMICS + PROTEOMICS</span></div>
                </div>
                <div class="ring-grid" id="score-rings"></div>
            </div>

            <!-- Interactive Network Graph -->
            <div class="analytics-module">
                <div class="module-header">
                    <div class="module-title">ðŸ•¸ï¸ Biomarker Network <span style="font-size:10px; color:var(--text-muted); font-weight:600; margin-left:12px;">CROSS-OMIC INTEGRATION</span></div>
                </div>
                <div class="network-container" id="network-graph"></div>
            </div>

            <!-- Advanced Inflammation Dashboard -->
            <div class="analytics-module">
                <div class="module-header">
                    <div class="module-title">ðŸ”¥ Inflammation Indices <span style="font-size:10px; color:var(--text-muted); font-weight:600; margin-left:12px;">PROTEOMICS + CELLULAR</span></div>
                </div>
                <div class="inflam-grid" id="inflam-dashboard"></div>
            </div>

            <!-- ONLY 3 KEY MICROBIOME METRICS -->
            <div class="analytics-module">
                <div class="module-header">
                    <div class="module-title">ðŸ¦  Microbiome Metrics <span style="font-size:10px; color:var(--text-muted); font-weight:600; margin-left:12px;">METAGENOMICS</span></div>
                </div>
                <div class="core-metrics-grid" id="core-metrics"></div>
            </div>
            
            <div style="text-align:center; margin-top:40px;">
                <button onclick="unlockLayer(7)" style="padding:16px 40px; background:linear-gradient(135deg,#10b981,#60a5fa); border:none; border-radius:12px; color:#fff; font-weight:700; cursor:pointer; font-size:14px; box-shadow:0 4px 12px rgba(16,185,129,0.3);">
                    ðŸ§  GENERATE AI DIAGNOSTIC â†’ LAYER 07
                </button>
            </div>
        </div>

        <div class="layer-content" id="layer7">
            <div class="alert success"><strong>ðŸ§  LAYER 07: AI DIAGNOSTIC SHEET</strong><br>Final clinical verdict using all analytics data to generate comprehensive diagnostic summary.</div>
            <div class="diagnostic-sheet" id="diagnostic-container"></div>
        </div>

        <footer class="footer">
            <strong>Developed by WASEEM AHANGER</strong>
        </footer>
    </div>
    <script>
    // PATIENT DATA WITH INFLAMMATION MARKERS - All 10 patients enhanced
    const PATIENTS=[
      {id:0,name:"Peak Sovereignty",age:32,bioAge:26,case:"Optimal Baseline",
        inflam:{il6:2.1,il2:25,il10:15,tnf_alpha:4.5,il1beta:1.8,neutrophils:55,lymphocytes:32,platelets:250,ldh:180},
        markers:{glucose:{value:82,ref:'70-99',unit:'mg/dL'},hba1c:{value:4.9,ref:'4.0-5.6',unit:'%'},insulin:{value:4.2,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:0.9,ref:'<1.8',unit:'index'},triglycerides:{value:85,ref:'<150',unit:'mg/dL'},hdl:{value:62,ref:'>45',unit:'mg/dL'},ldl:{value:78,ref:'<100',unit:'mg/dL'},apo_b:{value:64,ref:'<80',unit:'mg/dL'},lp_a:{value:12,ref:'<30',unit:'mg/dL'},crp:{value:0.4,ref:'<1.0',unit:'mg/L'},ferritin:{value:65,ref:'30-200',unit:'ng/mL'},cortisol:{value:12,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:8.5,ref:'5-15',unit:'Î¼mol/L'},alt:{value:20,ref:'<35',unit:'U/L'},ast:{value:22,ref:'<40',unit:'U/L'},ggt:{value:18,ref:'<55',unit:'U/L'},albumin:{value:4.5,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:4.2,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:0.9,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:105,ref:'>90',unit:'mL/min'},bun:{value:14,ref:'7-20',unit:'mg/dL'},vit_d:{value:42,ref:'30-100',unit:'ng/mL'},vit_b12:{value:520,ref:'200-900',unit:'pg/mL'},folate:{value:14.5,ref:'>5.4',unit:'ng/mL'},magnesium:{value:2.1,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:85,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:95,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:24.2,role:'Harvesting'},bacteroides:{value:36.5,role:'Burning'},akkermansia:{value:12.1,role:'Shield'},actinobacteria:{value:8.2,role:'Defense'},proteobacteria:{value:1.1,role:'Hazard'}}},
      
      {id:1,name:"Metabolic Crisis",age:58,bioAge:72,case:"Severe T2D Pattern",
        inflam:{il6:15.2,il2:65,il10:4.5,tnf_alpha:12.5,il1beta:8.2,neutrophils:75,lymphocytes:15,platelets:425,ldh:320},
        markers:{glucose:{value:152,ref:'70-99',unit:'mg/dL'},hba1c:{value:7.6,ref:'4.0-5.6',unit:'%'},insulin:{value:28.5,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:12.8,ref:'<1.8',unit:'index'},triglycerides:{value:245,ref:'<150',unit:'mg/dL'},hdl:{value:32,ref:'>45',unit:'mg/dL'},ldl:{value:165,ref:'<100',unit:'mg/dL'},apo_b:{value:145,ref:'<80',unit:'mg/dL'},lp_a:{value:68,ref:'<30',unit:'mg/dL'},crp:{value:8.5,ref:'<1.0',unit:'mg/L'},ferritin:{value:385,ref:'30-200',unit:'ng/mL'},cortisol:{value:32,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:18.5,ref:'5-15',unit:'Î¼mol/L'},alt:{value:58,ref:'<35',unit:'U/L'},ast:{value:62,ref:'<40',unit:'U/L'},ggt:{value:78,ref:'<55',unit:'U/L'},albumin:{value:3.2,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:8.9,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:1.4,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:62,ref:'>90',unit:'mL/min'},bun:{value:28,ref:'7-20',unit:'mg/dL'},vit_d:{value:18,ref:'30-100',unit:'ng/mL'},vit_b12:{value:185,ref:'200-900',unit:'pg/mL'},folate:{value:4.2,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.5,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:45,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:58,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:42.3,role:'Harvesting'},bacteroides:{value:18.1,role:'Burning'},akkermansia:{value:2.8,role:'Shield'},actinobacteria:{value:9.8,role:'Defense'},proteobacteria:{value:3.2,role:'Hazard'}}},
      
      {id:2,name:"Renal Decay",age:48,bioAge:57,case:"CKD Stage 3",
        inflam:{il6:7.5,il2:42,il10:8.2,tnf_alpha:9.8,il1beta:6.2,neutrophils:68,lymphocytes:22,platelets:320,ldh:245},
        markers:{glucose:{value:98,ref:'70-99',unit:'mg/dL'},hba1c:{value:5.4,ref:'4.0-5.6',unit:'%'},insulin:{value:8.5,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:2.1,ref:'<1.8',unit:'index'},triglycerides:{value:165,ref:'<150',unit:'mg/dL'},hdl:{value:42,ref:'>45',unit:'mg/dL'},ldl:{value:118,ref:'<100',unit:'mg/dL'},apo_b:{value:128,ref:'<80',unit:'mg/dL'},lp_a:{value:42,ref:'<30',unit:'mg/dL'},crp:{value:3.2,ref:'<1.0',unit:'mg/L'},ferritin:{value:215,ref:'30-200',unit:'ng/mL'},cortisol:{value:18,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:16.2,ref:'5-15',unit:'Î¼mol/L'},alt:{value:35,ref:'<35',unit:'U/L'},ast:{value:38,ref:'<40',unit:'U/L'},ggt:{value:52,ref:'<55',unit:'U/L'},albumin:{value:4.1,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:9.2,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:1.6,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:58,ref:'>90',unit:'mL/min'},bun:{value:32,ref:'7-20',unit:'mg/dL'},vit_d:{value:28,ref:'30-100',unit:'ng/mL'},vit_b12:{value:380,ref:'200-900',unit:'pg/mL'},folate:{value:8.5,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.9,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:72,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:78,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:28.5,role:'Harvesting'},bacteroides:{value:32.1,role:'Burning'},akkermansia:{value:5.2,role:'Shield'},actinobacteria:{value:7.8,role:'Defense'},proteobacteria:{value:2.8,role:'Hazard'}}}
      ,{id:3,name:"Inflammatory Storm",age:42,bioAge:52,case:"IBD Risk Pattern",
        inflam:{il6:18.5,il2:72,il10:3.8,tnf_alpha:14.2,il1beta:10.5,neutrophils:78,lymphocytes:14,platelets:445,ldh:335},
        markers:{glucose:{value:95,ref:'70-99',unit:'mg/dL'},hba1c:{value:5.8,ref:'4.0-5.6',unit:'%'},insulin:{value:12.5,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:3.2,ref:'<1.8',unit:'index'},triglycerides:{value:185,ref:'<150',unit:'mg/dL'},hdl:{value:38,ref:'>45',unit:'mg/dL'},ldl:{value:135,ref:'<100',unit:'mg/dL'},apo_b:{value:115,ref:'<80',unit:'mg/dL'},lp_a:{value:52,ref:'<30',unit:'mg/dL'},crp:{value:12.5,ref:'<1.0',unit:'mg/L'},ferritin:{value:425,ref:'30-200',unit:'ng/mL'},cortisol:{value:28,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:22.5,ref:'5-15',unit:'Î¼mol/L'},alt:{value:48,ref:'<35',unit:'U/L'},ast:{value:52,ref:'<40',unit:'U/L'},ggt:{value:68,ref:'<55',unit:'U/L'},albumin:{value:3.6,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:7.8,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:1.1,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:78,ref:'>90',unit:'mL/min'},bun:{value:22,ref:'7-20',unit:'mg/dL'},vit_d:{value:22,ref:'30-100',unit:'ng/mL'},vit_b12:{value:295,ref:'200-900',unit:'pg/mL'},folate:{value:6.8,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.6,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:55,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:62,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:38.5,role:'Harvesting'},bacteroides:{value:22.8,role:'Burning'},akkermansia:{value:3.5,role:'Shield'},actinobacteria:{value:11.2,role:'Defense'},proteobacteria:{value:4.5,role:'Hazard'}}},
      
      {id:4,name:"Lipid Particle Drift",age:52,bioAge:60,case:"CVD Risk",
        inflam:{il6:8.8,il2:48,il10:6.5,tnf_alpha:10.2,il1beta:7.5,neutrophils:70,lymphocytes:20,platelets:358,ldh:268},
        markers:{glucose:{value:92,ref:'70-99',unit:'mg/dL'},hba1c:{value:5.6,ref:'4.0-5.6',unit:'%'},insulin:{value:10.5,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:2.5,ref:'<1.8',unit:'index'},triglycerides:{value:210,ref:'<150',unit:'mg/dL'},hdl:{value:35,ref:'>45',unit:'mg/dL'},ldl:{value:158,ref:'<100',unit:'mg/dL'},apo_b:{value:138,ref:'<80',unit:'mg/dL'},lp_a:{value:75,ref:'<30',unit:'mg/dL'},crp:{value:4.8,ref:'<1.0',unit:'mg/L'},ferritin:{value:285,ref:'30-200',unit:'ng/mL'},cortisol:{value:22,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:17.5,ref:'5-15',unit:'Î¼mol/L'},alt:{value:42,ref:'<35',unit:'U/L'},ast:{value:45,ref:'<40',unit:'U/L'},ggt:{value:62,ref:'<55',unit:'U/L'},albumin:{value:3.8,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:8.2,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:1.2,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:72,ref:'>90',unit:'mL/min'},bun:{value:24,ref:'7-20',unit:'mg/dL'},vit_d:{value:25,ref:'30-100',unit:'ng/mL'},vit_b12:{value:325,ref:'200-900',unit:'pg/mL'},folate:{value:7.2,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.8,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:68,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:72,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:35.8,role:'Harvesting'},bacteroides:{value:24.2,role:'Burning'},akkermansia:{value:4.8,role:'Shield'},actinobacteria:{value:8.5,role:'Defense'},proteobacteria:{value:3.5,role:'Hazard'}}},
      
      {id:5,name:"Pre-Diabetic Shift",age:45,bioAge:51,case:"Borderline Pattern",
        inflam:{il6:6.5,il2:38,il10:9.2,tnf_alpha:8.5,il1beta:5.8,neutrophils:65,lymphocytes:24,platelets:295,ldh:225},
        markers:{glucose:{value:105,ref:'70-99',unit:'mg/dL'},hba1c:{value:5.9,ref:'4.0-5.6',unit:'%'},insulin:{value:15.2,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:3.8,ref:'<1.8',unit:'index'},triglycerides:{value:195,ref:'<150',unit:'mg/dL'},hdl:{value:40,ref:'>45',unit:'mg/dL'},ldl:{value:125,ref:'<100',unit:'mg/dL'},apo_b:{value:102,ref:'<80',unit:'mg/dL'},lp_a:{value:38,ref:'<30',unit:'mg/dL'},crp:{value:2.8,ref:'<1.0',unit:'mg/L'},ferritin:{value:245,ref:'30-200',unit:'ng/mL'},cortisol:{value:19,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:14.5,ref:'5-15',unit:'Î¼mol/L'},alt:{value:38,ref:'<35',unit:'U/L'},ast:{value:42,ref:'<40',unit:'U/L'},ggt:{value:58,ref:'<55',unit:'U/L'},albumin:{value:4.2,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:7.5,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:1,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:88,ref:'>90',unit:'mL/min'},bun:{value:18,ref:'7-20',unit:'mg/dL'},vit_d:{value:32,ref:'30-100',unit:'ng/mL'},vit_b12:{value:420,ref:'200-900',unit:'pg/mL'},folate:{value:9.5,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.9,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:75,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:82,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:32.5,role:'Harvesting'},bacteroides:{value:28.2,role:'Burning'},akkermansia:{value:7.5,role:'Shield'},actinobacteria:{value:8.8,role:'Defense'},proteobacteria:{value:2.2,role:'Hazard'}}},
      
      {id:6,name:"Nutrient Depletion",age:38,bioAge:44,case:"Micronutrient Deficiency",
        inflam:{il6:3.2,il2:22,il10:8.5,tnf_alpha:5.2,il1beta:2.8,neutrophils:58,lymphocytes:30,platelets:268,ldh:192},
        markers:{glucose:{value:88,ref:'70-99',unit:'mg/dL'},hba1c:{value:5.2,ref:'4.0-5.6',unit:'%'},insulin:{value:6.5,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:1.4,ref:'<1.8',unit:'index'},triglycerides:{value:125,ref:'<150',unit:'mg/dL'},hdl:{value:52,ref:'>45',unit:'mg/dL'},ldl:{value:95,ref:'<100',unit:'mg/dL'},apo_b:{value:72,ref:'<80',unit:'mg/dL'},lp_a:{value:22,ref:'<30',unit:'mg/dL'},crp:{value:1.2,ref:'<1.0',unit:'mg/L'},ferritin:{value:28,ref:'30-200',unit:'ng/mL'},cortisol:{value:15,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:11.5,ref:'5-15',unit:'Î¼mol/L'},alt:{value:28,ref:'<35',unit:'U/L'},ast:{value:32,ref:'<40',unit:'U/L'},ggt:{value:35,ref:'<55',unit:'U/L'},albumin:{value:4.3,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:5.2,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:0.9,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:98,ref:'>90',unit:'mL/min'},bun:{value:15,ref:'7-20',unit:'mg/dL'},vit_d:{value:18,ref:'30-100',unit:'ng/mL'},vit_b12:{value:175,ref:'200-900',unit:'pg/mL'},folate:{value:4.5,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.6,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:52,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:62,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:26.5,role:'Harvesting'},bacteroides:{value:34.2,role:'Burning'},akkermansia:{value:10.5,role:'Shield'},actinobacteria:{value:8.5,role:'Defense'},proteobacteria:{value:1.8,role:'Hazard'}}},
      
      {id:7,name:"Hepatic Stress",age:55,bioAge:62,case:"NAFLD Pattern",
        inflam:{il6:9.5,il2:52,il10:5.8,tnf_alpha:11.2,il1beta:8.5,neutrophils:72,lymphocytes:18,platelets:385,ldh:285},
        markers:{glucose:{value:102,ref:'70-99',unit:'mg/dL'},hba1c:{value:5.7,ref:'4.0-5.6',unit:'%'},insulin:{value:11.8,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:2.9,ref:'<1.8',unit:'index'},triglycerides:{value:225,ref:'<150',unit:'mg/dL'},hdl:{value:36,ref:'>45',unit:'mg/dL'},ldl:{value:142,ref:'<100',unit:'mg/dL'},apo_b:{value:125,ref:'<80',unit:'mg/dL'},lp_a:{value:45,ref:'<30',unit:'mg/dL'},crp:{value:3.5,ref:'<1.0',unit:'mg/L'},ferritin:{value:295,ref:'30-200',unit:'ng/mL'},cortisol:{value:17,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:15.8,ref:'5-15',unit:'Î¼mol/L'},alt:{value:65,ref:'<35',unit:'U/L'},ast:{value:55,ref:'<40',unit:'U/L'},ggt:{value:92,ref:'<55',unit:'U/L'},albumin:{value:3.9,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:7.9,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:1.1,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:82,ref:'>90',unit:'mL/min'},bun:{value:19,ref:'7-20',unit:'mg/dL'},vit_d:{value:28,ref:'30-100',unit:'ng/mL'},vit_b12:{value:365,ref:'200-900',unit:'pg/mL'},folate:{value:8.2,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.8,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:88,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:78,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:36.8,role:'Harvesting'},bacteroides:{value:25.5,role:'Burning'},akkermansia:{value:6.2,role:'Shield'},actinobacteria:{value:9.2,role:'Defense'},proteobacteria:{value:2.9,role:'Hazard'}}},
      
      {id:8,name:"Athletic Optimal",age:29,bioAge:24,case:"High Performance",
        inflam:{il6:1.8,il2:28,il10:18,tnf_alpha:3.8,il1beta:1.5,neutrophils:52,lymphocytes:35,platelets:235,ldh:165},
        markers:{glucose:{value:78,ref:'70-99',unit:'mg/dL'},hba1c:{value:4.7,ref:'4.0-5.6',unit:'%'},insulin:{value:3.5,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:0.7,ref:'<1.8',unit:'index'},triglycerides:{value:72,ref:'<150',unit:'mg/dL'},hdl:{value:68,ref:'>45',unit:'mg/dL'},ldl:{value:72,ref:'<100',unit:'mg/dL'},apo_b:{value:58,ref:'<80',unit:'mg/dL'},lp_a:{value:8,ref:'<30',unit:'mg/dL'},crp:{value:0.3,ref:'<1.0',unit:'mg/L'},ferritin:{value:72,ref:'30-200',unit:'ng/mL'},cortisol:{value:10,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:7.5,ref:'5-15',unit:'Î¼mol/L'},alt:{value:18,ref:'<35',unit:'U/L'},ast:{value:20,ref:'<40',unit:'U/L'},ggt:{value:15,ref:'<55',unit:'U/L'},albumin:{value:4.6,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:4.5,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:0.9,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:110,ref:'>90',unit:'mL/min'},bun:{value:12,ref:'7-20',unit:'mg/dL'},vit_d:{value:52,ref:'30-100',unit:'ng/mL'},vit_b12:{value:625,ref:'200-900',unit:'pg/mL'},folate:{value:16.2,ref:'>5.4',unit:'ng/mL'},magnesium:{value:2.2,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:95,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:102,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:22.5,role:'Harvesting'},bacteroides:{value:38.2,role:'Burning'},akkermansia:{value:13.5,role:'Shield'},actinobacteria:{value:7.8,role:'Defense'},proteobacteria:{value:0.9,role:'Hazard'}}},
      
      {id:9,name:"Thyroid Dysregulation",age:50,bioAge:56,case:"Subclinical Hypothyroid",
        inflam:{il6:5.2,il2:35,il10:10.5,tnf_alpha:7.2,il1beta:4.5,neutrophils:62,lymphocytes:26,platelets:285,ldh:210},
        markers:{glucose:{value:94,ref:'70-99',unit:'mg/dL'},hba1c:{value:5.5,ref:'4.0-5.6',unit:'%'},insulin:{value:9.2,ref:'2.0-25.0',unit:'Î¼U/mL'},homa_ir:{value:2.2,ref:'<1.8',unit:'index'},triglycerides:{value:178,ref:'<150',unit:'mg/dL'},hdl:{value:42,ref:'>45',unit:'mg/dL'},ldl:{value:132,ref:'<100',unit:'mg/dL'},apo_b:{value:118,ref:'<80',unit:'mg/dL'},lp_a:{value:48,ref:'<30',unit:'mg/dL'},crp:{value:2.5,ref:'<1.0',unit:'mg/L'},ferritin:{value:185,ref:'30-200',unit:'ng/mL'},cortisol:{value:24,ref:'6-23',unit:'Î¼g/dL'},homocysteine:{value:14.8,ref:'5-15',unit:'Î¼mol/L'},alt:{value:32,ref:'<35',unit:'U/L'},ast:{value:36,ref:'<40',unit:'U/L'},ggt:{value:48,ref:'<55',unit:'U/L'},albumin:{value:4,ref:'3.5-5.5',unit:'g/dL'},uric_acid:{value:6.8,ref:'3.5-7.2',unit:'mg/dL'},creatinine:{value:1,ref:'0.7-1.3',unit:'mg/dL'},egfr:{value:86,ref:'>90',unit:'mL/min'},bun:{value:17,ref:'7-20',unit:'mg/dL'},vit_d:{value:26,ref:'30-100',unit:'ng/mL'},vit_b12:{value:285,ref:'200-900',unit:'pg/mL'},folate:{value:7.8,ref:'>5.4',unit:'ng/mL'},magnesium:{value:1.8,ref:'1.7-2.2',unit:'mg/dL'},iron:{value:68,ref:'60-170',unit:'Î¼g/dL'},zinc:{value:75,ref:'66-110',unit:'Î¼g/dL'}},
        phyla:{firmicutes:{value:30.2,role:'Harvesting'},bacteroides:{value:29.5,role:'Burning'},akkermansia:{value:8.8,role:'Shield'},actinobacteria:{value:8.9,role:'Defense'},proteobacteria:{value:2.1,role:'Hazard'}}}
    ];

    // Constants from v1.0
    const MARKER_CATEGORIES={sugar:{name:'SUGAR',icon:'ðŸ¬',omic:'METABOLOMICS',markers:['glucose','hba1c','insulin','homa_ir']},cardiac:{name:'CARDIAC',icon:'â¤ï¸',omic:'METABOLOMICS',markers:['triglycerides','hdl','ldl','apo_b','lp_a']},fire:{name:'FIRE',icon:'ðŸ”¥',omic:'PROTEOMICS',markers:['crp','ferritin','cortisol','homocysteine']},liver:{name:'LIVER',icon:'ðŸ’§',omic:'METABOLOMICS',markers:['alt','ast','ggt','albumin']},renal:{name:'RENAL',icon:'ðŸ”¬',omic:'METABOLOMICS',markers:['uric_acid','creatinine','egfr','bun']},nutrient:{name:'NUTRIENT',icon:'ðŸ§¬',omic:'METABOLOMICS',markers:['vit_d','vit_b12','folate','magnesium','iron','zinc']}};
    const MARKER_NAMES={glucose:'GLU',hba1c:'A1C',insulin:'INS',homa_ir:'HOMA',triglycerides:'TRIG',hdl:'HDL',ldl:'LDL',apo_b:'ApoB',lp_a:'Lp(a)',crp:'CRP',ferritin:'FER',cortisol:'COR',homocysteine:'HCY',alt:'ALT',ast:'AST',ggt:'GGT',albumin:'ALB',uric_acid:'URIC',creatinine:'CREAT',egfr:'eGFR',bun:'BUN',vit_d:'VIT-D',vit_b12:'B12',folate:'FOL',magnesium:'MAG',iron:'FE',zinc:'ZN'};
    const GCC_MARKERS=['hba1c','homa_ir','apo_b','crp','ferritin','egfr'];

    let currentPatient=0,currentLayer=1,unlockedLayers=[1];

    function getStatus(id,v){const m=PATIENTS[currentPatient].markers[id],r=m.ref;if(r.includes('-')){const[min,max]=r.split('-').map(x=>parseFloat(x));if(v<min||v>max)return'rose';if(v<min*1.1||v>max*0.9)return'amber';return'green'}else if(r.startsWith('<')){const max=parseFloat(r.substring(1));if(v>=max)return'rose';if(v>=max*0.85)return'amber';return'green'}else if(r.startsWith('>')){const min=parseFloat(r.substring(1));if(v<=min)return'rose';if(v<=min*1.15)return'amber';return'green'}return'green'}

    function showProcessing(text,subtext){const o=document.getElementById('processing-overlay'),t=document.getElementById('processing-text'),s=document.getElementById('processing-subtext');t.textContent=text;s.textContent=subtext;o.classList.add('active')}
    function hideProcessing(){setTimeout(()=>{document.getElementById('processing-overlay').classList.remove('active')},800)}

    function init(){const s=document.getElementById('patient-select');PATIENTS.forEach((p,i)=>{const o=document.createElement('option');o.value=i;o.textContent=p.name;s.appendChild(o)});loadPatient()}

    function loadPatient(){currentPatient=parseInt(document.getElementById('patient-select').value);currentLayer=1;unlockedLayers=[1];for(let i=2;i<=6;i++){const b=document.getElementById(`layer${i}-btn`);b.classList.add('locked');b.classList.remove('active');document.getElementById(`layer${i}-status`).textContent='Locked'}switchLayer(1);renderClinicalLake()}

    function switchLayer(l){if(!unlockedLayers.includes(l))return;window.scrollTo({top:0,behavior:'smooth'});currentLayer=l;document.querySelectorAll('.layer-btn').forEach((b,i)=>b.classList.toggle('active',i+1===l));for(let i=1;i<=7;i++)document.getElementById(`layer${i}`).classList.toggle('active',i===l)}

    function unlockLayer(l){
        if(!unlockedLayers.includes(l)){
            unlockedLayers.push(l);
            const b=document.getElementById(`layer${l}-btn`);
            b.classList.remove('locked');
            document.getElementById(`layer${l}-status`).textContent='Unlocked';
        }
        
        // Add processing for Layer 6 (Advanced Analytics)
        if(l===6){
            showProcessing('âš¡ UNLOCKING ADVANCED ANALYTICS','Analyzing biomarker networks, inflammation indices, and microbiome metrics...');
            setTimeout(()=>{
                renderAdvancedAnalytics();
                hideProcessing();
            }, 1500);
        } else if(l===7){
            renderDiagnostic();
        }
        
        if(l!==6) switchLayer(l); // Switch immediately for non-Layer 6
        else setTimeout(()=>switchLayer(l), 1500); // Switch after processing for Layer 6
    }

    function renderClinicalLake(){const p=PATIENTS[currentPatient];document.getElementById('patient-header').innerHTML=`<div class="patient-name">${p.name.toUpperCase()}</div><div class="patient-meta">AGE: ${p.age} | BIO-AGE: ${p.bioAge} | ${p.case}</div>`;let opt=0;Object.entries(p.markers).forEach(([k,d])=>{if(getStatus(k,d.value)==='green')opt++});const hs=Math.round((opt/27)*100),ad=p.age-p.bioAge;let hst=hs>=85?'green':hs>=60?'amber':'rose',ast=ad>0?'green':'rose',ost=opt>=20?'green':opt>=15?'amber':'rose';document.getElementById('kpi-grid').innerHTML=`<div class="kpi-card ${hst}"><div class="kpi-label">ðŸŽ¯ Health Score</div><div class="kpi-value ${hst}">${hs}%</div><div class="kpi-subtitle">${hst==='green'?'âœ¨ Optimal':hst==='amber'?'âš ï¸ Warning':'ðŸš¨ Critical'}</div></div><div class="kpi-card ${ast}"><div class="kpi-label">â³ Biological Age</div><div class="kpi-value ${ast}">${p.bioAge}</div><div class="kpi-subtitle">${ad>0?`ðŸ’š -${ad} Years`:`âš ï¸ +${Math.abs(ad)} Years`}</div></div><div class="kpi-card ${ost}"><div class="kpi-label">âœ… Optimal Markers</div><div class="kpi-value ${ost}\">${opt}</div><div class="kpi-subtitle">of 27 Total</div></div><div class="kpi-card ${hst}"><div class="kpi-label">ðŸ”„ System Status</div><div class="kpi-value ${hst}">${hst==='green'?'âœ“':hst==='amber'?'!':'âœ—'}</div><div class="kpi-subtitle">${hst==='green'?'ðŸŸ¢ Sovereignty':hst==='amber'?'ðŸŸ¡ Drift':'ðŸ”´ Decoherence'}</div></div>`;renderGCC(p);renderBlobs(p);renderPhyla(p)}

    function renderGCC(p){let tot=0;GCC_MARKERS.forEach(id=>{const st=getStatus(id,p.markers[id].value);if(st==='green')tot+=100;else if(st==='amber')tot+=50});const sc=Math.round(tot/600*100);let gr='F';if(sc>=90)gr='A+';else if(sc>=80)gr='A';else if(sc>=70)gr='B';else if(sc>=60)gr='C';else if(sc>=50)gr='D';const gst=sc>=70?'green':sc>=50?'amber':'rose';let html=`<div class="gcc-section ${gst}"><div class="gcc-header"><div class="gcc-title">âš ï¸ GCC CRITICAL CONTROL PANEL <span style="font-size:9px; font-weight:600; color:var(--text-muted); margin-left:10px;">METABOLOMICS + PROTEOMICS</span></div><div class="gcc-score-card ${gst}"><div class="gcc-score-label">GCC Score</div><div class="gcc-score-value ${gst}">${sc}%</div><div class="gcc-score-grade">Grade: ${gr}</div></div></div><div class="gcc-grid">`;GCC_MARKERS.forEach(id=>{const d=p.markers[id],st=getStatus(id,d.value);html+=`<div class="gcc-marker ${st}"><div class="gcc-marker-name">${MARKER_NAMES[id]}</div><div class="gcc-marker-value ${st}">${d.value}<div class="gcc-marker-unit">${d.unit}</div></div></div>`});html+=`</div></div>`;document.getElementById('gcc-section').innerHTML=html}

    function renderBlobs(p){const g=document.getElementById('blobs-grid');g.innerHTML='';Object.entries(MARKER_CATEGORIES).forEach(([k,c])=>{const b=document.createElement('div');b.className='blob';b.innerHTML=`<div class="blob-header"><div class="blob-icon">${c.icon}</div><div class="blob-name">${c.name}</div></div><div style="font-size:8px; font-weight:700; color:var(--text-muted); padding:4px 8px; background:rgba(59,130,246,0.1); border-radius:4px; margin-bottom:8px; text-align:center; letter-spacing:0.5px;">${c.omic}</div>`;c.markers.forEach(m=>{const d=p.markers[m],st=getStatus(m,d.value),i=document.createElement('div');i.className=`marker-item ${st}`;i.innerHTML=`<div class="marker-name">${MARKER_NAMES[m]}</div><div class="marker-value ${st}">${d.value}<span class="marker-unit">${d.unit}</span></div><div class="marker-ref ${st}">Ref: ${d.ref}</div>`;b.appendChild(i)});g.appendChild(b)})}

    function renderPhyla(p){const g=document.getElementById('phyla-grid');g.innerHTML='';const ph=[{k:'firmicutes',c:'#3b82f6'},{k:'bacteroides',c:'#10b981'},{k:'akkermansia',c:'#8b5cf6'},{k:'actinobacteria',c:'#ef4444'},{k:'proteobacteria',c:'#f59e0b'}];ph.forEach(x=>{const d=p.phyla[x.k],c=document.createElement('div');c.className='phyla-card';c.innerHTML=`<div class="phyla-circle" style="background:${x.c};color:white">${d.value}%</div><div class="phyla-name">${d.role}</div><div class="phyla-role">${x.k.toUpperCase()}</div>`;g.appendChild(c)})}

    // NEW FUNCTION: Analyze and render comprehensive inflammation container
    function analyzeInflammation(){showProcessing('ðŸ”¥ ANALYZING INFLAMMATION','Processing cytokines, cellular markers, and ratios...');setTimeout(()=>{unlockLayer(2);renderInflammation();hideProcessing()},1500)}
    window.analyzeInflammation = analyzeInflammation;  // Make sure it's globally accessible

    function renderInflammation(){
        const p=PATIENTS[currentPatient];
        if(!p || !p.inflam || !p.markers) {
            document.getElementById('layer2-content').innerHTML = '<div style="padding:40px;text-align:center;color:var(--text-muted);">Inflammation data not available</div>';
            return;
        }
        const inf=p.inflam;
        const m=p.markers;
    
    // Helper to get inflammation marker status
    const getSt=(val,ref)=>{if(ref.includes('-')){const[min,max]=ref.split('-').map(parseFloat);return val<min||val>max?'rose':val<min*1.1||val>max*0.9?'amber':'green'}else if(ref.startsWith('<')){const max=parseFloat(ref.substring(1));return val>=max?'rose':val>=max*0.85?'amber':'green'}else if(ref.startsWith('>')){const min=parseFloat(ref.substring(1));return val<=min?'rose':val<=min*1.15?'amber':'green'}return'green'};
    
    // Calculate ratios with safety checks
    const nlr=((inf.neutrophils || 0)/(inf.lymphocytes || 1)).toFixed(2);
    const plr=((inf.platelets || 0)/(inf.lymphocytes || 1)).toFixed(1);
    const crpAlb=((m.crp?.value || 0)/(m.albumin?.value || 1)).toFixed(2);
    
    // Get statuses
    const il6St=getSt(inf.il6 || 0,'<5'),il2St=getSt(inf.il2 || 0,'10-50'),il10St=getSt(inf.il10 || 0,'5-50'),tnfSt=getSt(inf.tnf_alpha || 0,'<8.1'),il1St=getSt(inf.il1beta || 0,'<5');
    const neuSt=getSt(inf.neutrophils || 0,'40-70'),lymSt=getSt(inf.lymphocytes || 0,'20-40'),pltSt=getSt(inf.platelets || 0,'150-400'),ldhSt=getSt(inf.ldh || 0,'140-280');
    const crpSt=getStatus('crp',m.crp?.value || 0),ferSt=getStatus('ferritin',m.ferritin?.value || 0),corSt=getStatus('cortisol',m.cortisol?.value || 0),hcySt=getStatus('homocysteine',m.homocysteine?.value || 0),albSt=getStatus('albumin',m.albumin?.value || 0);
    const nlrSt=parseFloat(nlr)>5?'rose':parseFloat(nlr)>3?'amber':'green';
    const plrSt=parseFloat(plr)>200?'rose':parseFloat(plr)>150?'amber':'green';
    const crpAlbSt=parseFloat(crpAlb)>0.5?'rose':parseFloat(crpAlb)>0.3?'amber':'green';
    
    // Calculate inflammation state score
    let score=0;
    if(il6St==='rose')score+=15;else if(il6St==='amber')score+=8;
    if(tnfSt==='rose')score+=15;else if(tnfSt==='amber')score+=8;
    if(il1St==='rose')score+=10;else if(il1St==='amber')score+=5;
    if(nlrSt==='rose')score+=20;else if(nlrSt==='amber')score+=10;
    if(plrSt==='rose')score+=15;else if(plrSt==='amber')score+=8;
    if(crpAlbSt==='rose')score+=15;else if(crpAlbSt==='amber')score+=8;
    if(ferSt==='rose')score+=10;else if(ferSt==='amber')score+=5;
    
    const stateTxt=score<30?'LOW':score<60?'MEDIUM':'HIGH';
    const stateSt=score<30?'green':score<60?'amber':'rose';
    const borderColor=score<30?'#10b981':score<60?'#f59e0b':'#ef4444'; // Green/Yellow/Red
    
    document.getElementById('layer2-content').innerHTML=`
    <div class="inflammation-comprehensive" style="border: 3px solid ${borderColor}; border-radius: 16px; padding: 24px;">
      <div class="inflam-main-header">
        <div class="inflam-main-title">ðŸ”¥ COMPREHENSIVE INFLAMMATION CONTAINER</div>
        <div class="inflam-subtitle">5 Sections â€¢ Auto-Calculated Ratios â€¢ Overall State Scoring</div>
      </div>
      
      <div class="inflam-section">
        <div class="inflam-section-title">1ï¸âƒ£ CYTOKINE PANEL</div>
        <div class="inflam-grid">
          <div class="inflam-marker ${il6St}"><div class="inflam-marker-name">IL-6</div><div class="inflam-marker-value ${il6St}">${inf.il6 || 0}<span class="inflam-marker-unit">pg/mL</span></div><div class="inflam-marker-ref">Normal: <5</div></div>
          <div class="inflam-marker ${tnfSt}"><div class="inflam-marker-name">TNF-Î±</div><div class="inflam-marker-value ${tnfSt}">${inf.tnf_alpha || 0}<span class="inflam-marker-unit">pg/mL</span></div><div class="inflam-marker-ref">Normal: <8.1</div></div>
          <div class="inflam-marker ${il1St}"><div class="inflam-marker-name">IL-1Î²</div><div class="inflam-marker-value ${il1St}">${inf.il1beta || 0}<span class="inflam-marker-unit">pg/mL</span></div><div class="inflam-marker-ref">Normal: <5</div></div>
          <div class="inflam-marker ${il2St}"><div class="inflam-marker-name">IL-2</div><div class="inflam-marker-value ${il2St}">${inf.il2 || 0}<span class="inflam-marker-unit">pg/mL</span></div><div class="inflam-marker-ref">Normal: 10-50</div></div>
          <div class="inflam-marker ${il10St}"><div class="inflam-marker-name">IL-10</div><div class="inflam-marker-value ${il10St}">${inf.il10 || 0}<span class="inflam-marker-unit">pg/mL</span></div><div class="inflam-marker-ref">Normal: 5-50</div></div>
        </div>
      </div>
      
      <div class="inflam-section">
        <div class="inflam-section-title">2ï¸âƒ£ CELLULAR MARKERS</div>
        <div class="inflam-grid">
          <div class="inflam-marker ${neuSt}"><div class="inflam-marker-name">Neutrophils</div><div class="inflam-marker-value ${neuSt}">${inf.neutrophils || 0}<span class="inflam-marker-unit">%</span></div><div class="inflam-marker-ref">Normal: 40-70%</div></div>
          <div class="inflam-marker ${lymSt}"><div class="inflam-marker-name">Lymphocytes</div><div class="inflam-marker-value ${lymSt}">${inf.lymphocytes || 0}<span class="inflam-marker-unit">%</span></div><div class="inflam-marker-ref">Normal: 20-40%</div></div>
          <div class="inflam-marker ${pltSt}"><div class="inflam-marker-name">Platelets</div><div class="inflam-marker-value ${pltSt}">${inf.platelets || 0}<span class="inflam-marker-unit">K/Î¼L</span></div><div class="inflam-marker-ref">Normal: 150-400</div></div>
        </div>
      </div>
      
      <div class="inflam-section">
        <div class="inflam-section-title">3ï¸âƒ£ SYSTEMIC INFLAMMATION</div>
        <div class="inflam-grid-2">
          <div class="inflam-marker ${crpSt}"><div class="inflam-marker-name">C-Reactive Protein</div><div class="inflam-marker-value ${crpSt}">${m.crp?.value || 0}<span class="inflam-marker-unit">${m.crp?.unit || ''}</span></div><div class="inflam-marker-ref">Ref: ${m.crp?.ref || 'N/A'}</div></div>
          <div class="inflam-marker ${ferSt}"><div class="inflam-marker-name">Ferritin</div><div class="inflam-marker-value ${ferSt}">${m.ferritin?.value || 0}<span class="inflam-marker-unit">${m.ferritin?.unit || ''}</span></div><div class="inflam-marker-ref">Ref: ${m.ferritin?.ref || 'N/A'}</div></div>
          <div class="inflam-marker ${ldhSt}"><div class="inflam-marker-name">LDH</div><div class="inflam-marker-value ${ldhSt}">${inf.ldh || 0}<span class="inflam-marker-unit">U/L</span></div><div class="inflam-marker-ref">Normal: 140-280</div></div>
          <div class="inflam-marker ${albSt}"><div class="inflam-marker-name">Albumin</div><div class="inflam-marker-value ${albSt}">${m.albumin?.value || 0}<span class="inflam-marker-unit">${m.albumin?.unit || ''}</span></div><div class="inflam-marker-ref">Ref: ${m.albumin?.ref || 'N/A'}</div></div>
          <div class="inflam-marker ${corSt}"><div class="inflam-marker-name">Cortisol</div><div class="inflam-marker-value ${corSt}">${m.cortisol?.value || 0}<span class="inflam-marker-unit">${m.cortisol?.unit || ''}</span></div><div class="inflam-marker-ref">Ref: ${m.cortisol?.ref || 'N/A'}</div></div>
          <div class="inflam-marker ${hcySt}"><div class="inflam-marker-name">Homocysteine</div><div class="inflam-marker-value ${hcySt}">${m.homocysteine?.value || 0}<span class="inflam-marker-unit">${m.homocysteine?.unit || ''}</span></div><div class="inflam-marker-ref">Ref: ${m.homocysteine?.ref || 'N/A'}</div></div>
        </div>
      </div>
      
      <div class="inflam-section">
        <div class="inflam-section-title">4ï¸âƒ£ INFLAMMATION RATIOS (Auto-Calculated)</div>
        <div class="inflam-grid">
          <div class="inflam-marker ${nlrSt}"><div class="inflam-marker-name">Neutrophil-to-Lymphocyte Ratio</div><div class="inflam-marker-value ${nlrSt}">${nlr}</div><div class="inflam-marker-ref">Normal: <3.0</div></div>
          <div class="inflam-marker ${plrSt}"><div class="inflam-marker-name">Platelet-to-Lymphocyte Ratio</div><div class="inflam-marker-value ${plrSt}">${plr}</div><div class="inflam-marker-ref">Normal: <150</div></div>
          <div class="inflam-marker ${crpAlbSt}"><div class="inflam-marker-name">CRP-to-Albumin Ratio</div><div class="inflam-marker-value ${crpAlbSt}">${crpAlb}</div><div class="inflam-marker-ref">Normal: <0.3</div></div>
        </div>
      </div>
      
      <div class="inflam-state-final ${stateSt}">
        <div class="inflam-state-label">âš ï¸ OVERALL INFLAMMATION STATE</div>
        <div class="inflam-state-value ${stateSt}">${stateTxt}</div>
        <div class="inflam-state-score">${score}/100 Points</div>
      </div>
    </div>`;}

    // Helper function for phyla status
    function getPhylaStatus(phyla,value){if(phyla==='firmicutes'){if(value>35)return'rose';if(value>30)return'amber';return'green'}else if(phyla==='bacteroides'){if(value<25)return'rose';if(value<30)return'amber';return'green'}else if(phyla==='akkermansia'){if(value<5)return'rose';if(value<8)return'amber';return'green'}else if(phyla==='actinobacteria'){if(value>10)return'rose';if(value>9)return'amber';return'green'}else if(phyla==='proteobacteria'){if(value>3)return'rose';if(value>2)return'amber';return'green'}return'green'}

    // Layer 3: Complete Sentinel Analysis
    function analyzeSentinel(){showProcessing('ANALYZING SENTINEL','Identifying critical inflammation & stress markers...');setTimeout(()=>{unlockLayer(3);const p=PATIENTS[currentPatient],g=document.getElementById('sentinel-grid');g.innerHTML='';const crp=p.markers.crp,fer=p.markers.ferritin,cor=p.markers.cortisol,crps=getStatus('crp',crp.value),fers=getStatus('ferritin',fer.value),cors=getStatus('cortisol',cor.value);let ist='green',ivd='NO FIRE',ird=[];if(crps==='rose'){ist='rose';ivd='FIRE DETECTED';ird.push({m:'hs-CRP',v:crp.value,u:crp.unit,r:`Severe inflammation. CRP ${crp.value} is ${((crp.value/1)*100).toFixed(0)}% above normal.`})}else if(crps==='amber'){ist='amber';ivd='WARNING';ird.push({m:'hs-CRP',v:crp.value,u:crp.unit,r:`Early inflammation. CRP ${crp.value} approaching critical.`})}else{ird.push({m:'hs-CRP',v:crp.value,u:crp.unit,r:`Inflammation optimal. CRP ${crp.value} well within range.`})}if(fers==='rose'){if(ist!=='rose')ist='rose';ivd='FIRE DETECTED';ird.push({m:'FERRITIN',v:fer.value,u:fer.unit,r:`Iron dysregulation. Ferritin ${fer.value} indicates chronic inflammation.`})}else if(fers==='amber'){if(ist==='green')ist='amber';if(ivd==='NO FIRE')ivd='WARNING';ird.push({m:'FERRITIN',v:fer.value,u:fer.unit,r:`Elevated iron storage trending toward inflammatory range.`})}else{ird.push({m:'FERRITIN',v:fer.value,u:fer.unit,r:`Iron storage optimal. Ferritin ${fer.value} within healthy range.`})}const ic=document.createElement('div');ic.className=`sentinel-card ${ist}`;ic.innerHTML=`<div class="sentinel-header"><div class="sentinel-label">INFLAMMATION SENTINEL</div><div class="sentinel-status ${ist}">${ivd}</div><div class="sentinel-verdict">Systemic Fire Analysis</div></div><div class="sentinel-details">${ird.map(r=>`<div class="sentinel-marker"><div><div class="sentinel-marker-name">${r.m}</div><div class="sentinel-marker-reason">${r.r}</div></div><div class="sentinel-marker-value ${ist}">${r.v}<div style="font-size:10px">${r.u}</div></div></div>`).join('')}</div>`;g.appendChild(ic);let sst='green',svd='NO STRESS',srd=[];if(cors==='rose'){sst='rose';svd='STRESS DETECTED';srd.push({m:'CORTISOL',v:cor.value,u:cor.unit,r:`HPA axis dysregulation. Cortisol ${cor.value} indicates chronic stress.`})}else if(cors==='amber'){sst='amber';svd='WARNING';srd.push({m:'CORTISOL',v:cor.value,u:cor.unit,r:`Elevated stress hormone approaching critical threshold.`})}else{srd.push({m:'CORTISOL',v:cor.value,u:cor.unit,r:`Cortisol optimal. HPA axis functioning normally.`})}const sc=document.createElement('div');sc.className=`sentinel-card ${sst}`;sc.innerHTML=`<div class="sentinel-header"><div class="sentinel-label">STRESS SENTINEL</div><div class="sentinel-status ${sst}">${svd}</div><div class="sentinel-verdict">HPA Axis Analysis</div></div><div class="sentinel-details">${srd.map(r=>`<div class="sentinel-marker"><div><div class="sentinel-marker-name">${r.m}</div><div class="sentinel-marker-reason">${r.r}</div></div><div class="sentinel-marker-value ${sst}">${r.v}<div style="font-size:10px">${r.u}</div></div></div>`).join('')}</div>`;g.appendChild(sc);hideProcessing()},1500)}

    function getInflammationState(p){
        if(!p || !p.inflam || !p.markers) return {state:'LOW',score:0};
        const inf=p.inflam,m=p.markers;
        const getSt=(val,ref)=>{if(ref.includes('-')){const[min,max]=ref.split('-').map(parseFloat);return val<min||val>max?'rose':val<min*1.1||val>max*0.9?'amber':'green'}else if(ref.startsWith('<')){const max=parseFloat(ref.substring(1));return val>=max?'rose':val>=max*0.85?'amber':'green'}else if(ref.startsWith('>')){const min=parseFloat(ref.substring(1));return val<=min?'rose':val<=min*1.15?'amber':'green'}return'green'};
        const nlr=((inf.neutrophils || 0)/(inf.lymphocytes || 1)).toFixed(2);
        const plr=((inf.platelets || 0)/(inf.lymphocytes || 1)).toFixed(1);
        const crpAlb=((m.crp?.value || 0)/(m.albumin?.value || 1)).toFixed(2);
        const il6St=getSt(inf.il6 || 0,'<5'),tnfSt=getSt(inf.tnf_alpha || 0,'<8.1'),il1St=getSt(inf.il1beta || 0,'<5');
        const ferSt=getStatus('ferritin',m.ferritin?.value || 0);
        const nlrSt=parseFloat(nlr)>5?'rose':parseFloat(nlr)>3?'amber':'green';
        const plrSt=parseFloat(plr)>200?'rose':parseFloat(plr)>150?'amber':'green';
        const crpAlbSt=parseFloat(crpAlb)>0.5?'rose':parseFloat(crpAlb)>0.3?'amber':'green';
        let score=0;
        if(il6St==='rose')score+=15;else if(il6St==='amber')score+=8;
        if(tnfSt==='rose')score+=15;else if(tnfSt==='amber')score+=8;
        if(il1St==='rose')score+=10;else if(il1St==='amber')score+=5;
        if(nlrSt==='rose')score+=20;else if(nlrSt==='amber')score+=10;
        if(plrSt==='rose')score+=15;else if(plrSt==='amber')score+=8;
        if(crpAlbSt==='rose')score+=15;else if(crpAlbSt==='amber')score+=8;
        if(ferSt==='rose')score+=10;else if(ferSt==='amber')score+=5;
        const state=score<30?'LOW':score<60?'MEDIUM':'HIGH';
        return{state,score};
    }

    function getSentinelState(p){
        if(!p || !p.markers) return {inflammation:'âœ…',stress:'âœ…'};
        const crps=getStatus('crp',p.markers.crp?.value || 0);
        const fers=getStatus('ferritin',p.markers.ferritin?.value || 0);
        const cors=getStatus('cortisol',p.markers.cortisol?.value || 0);
        let inflammation='âœ…',stress='âœ…';
        if(crps==='rose'||fers==='rose')inflammation='ðŸ”´';
        else if(crps==='amber'||fers==='amber')inflammation='ðŸŸ¡';
        if(cors==='rose')stress='ðŸ”´';
        else if(cors==='amber')stress='ðŸŸ¡';
        return{inflammation,stress};
    }



    // Layer 4: Complete Cohort Matrix
    function analyzeCohorts(){showProcessing('ANALYZING COHORTS','Computing disease pattern matching...');setTimeout(()=>{unlockLayer(4);renderCohortMatrix();hideProcessing()},1500)}

    function renderCohortMatrix(){const p=PATIENTS[currentPatient],g=document.getElementById('cohort-grid');g.innerHTML='';const cohorts=[{i:'ðŸ¬',n:'T2D Syndrome',m:'HOMA-IR + HbA1c + F:B',f:calcT2D},{i:'â¤ï¸',n:'Cardio Hazard',m:'ApoB + Lp(a) + Urate',f:calcCardio},{i:'ðŸ”¥',n:'IBD Pattern',m:'CRP + Ferritin + Akkermansia',f:calcIBD},{i:'ðŸ’Š',n:'Metabolic Obesity',m:'Triglycerides + HDL + HOMA',f:calcObesity},{i:'ðŸ”¬',n:'Renal Decay',m:'eGFR + Urate + Creatinine',f:calcRenal},{i:'ðŸ’§',n:'NAFLD Risk',m:'ALT + AST + Triglycerides',f:calcNAFLD},{i:'ðŸ§¬',n:'Nutrient Depletion',m:'Vit-D + B12 + Iron',f:calcNutrient},{i:'âš¡',n:'Thyroid Stress',m:'Cortisol + Ferritin + CRP',f:calcThyroid},{i:'ðŸ”¥',n:'Chronic Inflammation',m:'IL-6 + CRP + NLR',f:calcInflammation}];cohorts.forEach(co=>{const res=co.f(p);let r='optimal',st='Optimal Performance';if(res.pct>0){if(res.pct<30){r='low';st='Low Risk'}else if(res.pct<60){r='medium';st='Medium Risk'}else{r='high';st='High Risk'}}const c=document.createElement('div');c.className=`cohort-card ${r}`;c.innerHTML=`<div class="cohort-main"><div class="cohort-icon">${co.i}</div><div class="cohort-info"><h3>${co.n}</h3><div class="cohort-markers">${co.m}</div></div><div><div class="cohort-percent ${r}">${res.pct}%</div><div class="cohort-label">Match</div><div class="cohort-status">${st}</div></div></div><div class="cohort-deep-dive"><div class="deep-dive-title">ðŸ”¬ MATHEMATICAL BREAKDOWN</div><div class="math-breakdown">${res.bd.map(b=>`<div class="math-row"><div class="math-condition">${b.c}</div><div class="math-logic">${b.l}</div><div class="math-score ${b.s}">${b.p>0?'+':''}${b.p} pts</div></div>`).join('')}<div class="math-total">TOTAL: ${res.pct}% MATCH ${res.pct===0?'(OPTIMAL)':''}</div></div></div>`;g.appendChild(c)})}

    function calcT2D(p){const hm=p.markers.homa_ir.value,hb=p.markers.hba1c.value,fb=p.phyla.firmicutes.value/p.phyla.bacteroides.value;const bd=[];let sc=0;if(hm>3){sc+=40;bd.push({c:'HOMA-IR > 3.0',l:`Value: ${hm} â†’ TRUE`,p:40,s:'rose'})}else if(hm>1.8){sc+=20;bd.push({c:'HOMA-IR > 1.8',l:`Value: ${hm} â†’ TRUE`,p:20,s:'amber'})}else{bd.push({c:'HOMA-IR < 1.8',l:`Value: ${hm} â†’ OPTIMAL`,p:0,s:'green'})}if(hb>6){sc+=30;bd.push({c:'HbA1c > 6.0',l:`Value: ${hb} â†’ TRUE`,p:30,s:'rose'})}else if(hb>5.6){sc+=15;bd.push({c:'HbA1c > 5.6',l:`Value: ${hb} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'HbA1c < 5.6',l:`Value: ${hb} â†’ OPTIMAL`,p:0,s:'green'})}if(fb>1.2){sc+=30;bd.push({c:'F:B Ratio > 1.2',l:`Value: ${fb.toFixed(2)} â†’ TRUE`,p:30,s:'rose'})}else if(fb>1){sc+=15;bd.push({c:'F:B Ratio > 1.0',l:`Value: ${fb.toFixed(2)} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'F:B Ratio < 1.0',l:`Value: ${fb.toFixed(2)} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcCardio(p){const ab=p.markers.apo_b.value,lp=p.markers.lp_a.value,ua=p.markers.uric_acid.value;const bd=[];let sc=0;if(ab>100){sc+=35;bd.push({c:'ApoB > 100',l:`Value: ${ab} â†’ TRUE`,p:35,s:'rose'})}else if(ab>80){sc+=18;bd.push({c:'ApoB > 80',l:`Value: ${ab} â†’ TRUE`,p:18,s:'amber'})}else{bd.push({c:'ApoB < 80',l:`Value: ${ab} â†’ OPTIMAL`,p:0,s:'green'})}if(lp>50){sc+=25;bd.push({c:'Lp(a) > 50',l:`Value: ${lp} â†’ TRUE`,p:25,s:'rose'})}else if(lp>30){sc+=12;bd.push({c:'Lp(a) > 30',l:`Value: ${lp} â†’ TRUE`,p:12,s:'amber'})}else{bd.push({c:'Lp(a) < 30',l:`Value: ${lp} â†’ OPTIMAL`,p:0,s:'green'})}if(ua>7.2){sc+=25;bd.push({c:'Urate > 7.2',l:`Value: ${ua} â†’ TRUE`,p:25,s:'rose'})}else if(ua>6){sc+=12;bd.push({c:'Urate > 6.0',l:`Value: ${ua} â†’ TRUE`,p:12,s:'amber'})}else{bd.push({c:'Urate < 6.0',l:`Value: ${ua} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcIBD(p){const cr=p.markers.crp.value,fe=p.markers.ferritin.value,ak=p.phyla.akkermansia.value;const bd=[];let sc=0;if(cr>5){sc+=40;bd.push({c:'CRP > 5.0',l:`Value: ${cr} â†’ TRUE`,p:40,s:'rose'})}else if(cr>1){sc+=20;bd.push({c:'CRP > 1.0',l:`Value: ${cr} â†’ TRUE`,p:20,s:'amber'})}else{bd.push({c:'CRP < 1.0',l:`Value: ${cr} â†’ OPTIMAL`,p:0,s:'green'})}if(fe>300){sc+=20;bd.push({c:'Ferritin > 300',l:`Value: ${fe} â†’ TRUE`,p:20,s:'rose'})}else if(fe>200){sc+=10;bd.push({c:'Ferritin > 200',l:`Value: ${fe} â†’ TRUE`,p:10,s:'amber'})}else{bd.push({c:'Ferritin < 200',l:`Value: ${fe} â†’ OPTIMAL`,p:0,s:'green'})}if(ak<5){sc+=25;bd.push({c:'Akkermansia < 5%',l:`Value: ${ak}% â†’ TRUE`,p:25,s:'rose'})}else if(ak<8){sc+=12;bd.push({c:'Akkermansia < 8%',l:`Value: ${ak}% â†’ TRUE`,p:12,s:'amber'})}else{bd.push({c:'Akkermansia > 8%',l:`Value: ${ak}% â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcObesity(p){const tg=p.markers.triglycerides.value,hd=p.markers.hdl.value,hm=p.markers.homa_ir.value;const bd=[];let sc=0;if(tg>150){sc+=35;bd.push({c:'Triglycerides > 150',l:`Value: ${tg} â†’ TRUE`,p:35,s:'rose'})}else if(tg>120){sc+=18;bd.push({c:'Triglycerides > 120',l:`Value: ${tg} â†’ TRUE`,p:18,s:'amber'})}else{bd.push({c:'Triglycerides < 120',l:`Value: ${tg} â†’ OPTIMAL`,p:0,s:'green'})}if(hd<45){sc+=30;bd.push({c:'HDL < 45',l:`Value: ${hd} â†’ TRUE`,p:30,s:'rose'})}else if(hd<50){sc+=15;bd.push({c:'HDL < 50',l:`Value: ${hd} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'HDL > 50',l:`Value: ${hd} â†’ OPTIMAL`,p:0,s:'green'})}if(hm>2.5){sc+=35;bd.push({c:'HOMA-IR > 2.5',l:`Value: ${hm} â†’ TRUE`,p:35,s:'rose'})}else if(hm>1.8){sc+=18;bd.push({c:'HOMA-IR > 1.8',l:`Value: ${hm} â†’ TRUE`,p:18,s:'amber'})}else{bd.push({c:'HOMA-IR < 1.8',l:`Value: ${hm} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcRenal(p){const eg=p.markers.egfr.value,ua=p.markers.uric_acid.value,cr=p.markers.creatinine.value;const bd=[];let sc=0;if(eg<60){sc+=40;bd.push({c:'eGFR < 60',l:`Value: ${eg} â†’ TRUE`,p:40,s:'rose'})}else if(eg<90){sc+=20;bd.push({c:'eGFR < 90',l:`Value: ${eg} â†’ TRUE`,p:20,s:'amber'})}else{bd.push({c:'eGFR > 90',l:`Value: ${eg} â†’ OPTIMAL`,p:0,s:'green'})}if(ua>7.5){sc+=30;bd.push({c:'Urate > 7.5',l:`Value: ${ua} â†’ TRUE`,p:30,s:'rose'})}else if(ua>6.5){sc+=15;bd.push({c:'Urate > 6.5',l:`Value: ${ua} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'Urate < 6.5',l:`Value: ${ua} â†’ OPTIMAL`,p:0,s:'green'})}if(cr>1.3){sc+=15;bd.push({c:'Creatinine > 1.3',l:`Value: ${cr} â†’ TRUE`,p:15,s:'rose'})}else if(cr>1.1){sc+=8;bd.push({c:'Creatinine > 1.1',l:`Value: ${cr} â†’ TRUE`,p:8,s:'amber'})}else{bd.push({c:'Creatinine < 1.1',l:`Value: ${cr} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcNAFLD(p){const al=p.markers.alt.value,as=p.markers.ast.value,tg=p.markers.triglycerides.value;const bd=[];let sc=0;if(al>35){sc+=35;bd.push({c:'ALT > 35',l:`Value: ${al} â†’ TRUE`,p:35,s:'rose'})}else if(al>28){sc+=18;bd.push({c:'ALT > 28',l:`Value: ${al} â†’ TRUE`,p:18,s:'amber'})}else{bd.push({c:'ALT < 28',l:`Value: ${al} â†’ OPTIMAL`,p:0,s:'green'})}if(as>40){sc+=25;bd.push({c:'AST > 40',l:`Value: ${as} â†’ TRUE`,p:25,s:'rose'})}else if(as>32){sc+=12;bd.push({c:'AST > 32',l:`Value: ${as} â†’ TRUE`,p:12,s:'amber'})}else{bd.push({c:'AST < 32',l:`Value: ${as} â†’ OPTIMAL`,p:0,s:'green'})}if(tg>150){sc+=35;bd.push({c:'Triglycerides > 150',l:`Value: ${tg} â†’ TRUE`,p:35,s:'rose'})}else if(tg>120){sc+=18;bd.push({c:'Triglycerides > 120',l:`Value: ${tg} â†’ TRUE`,p:18,s:'amber'})}else{bd.push({c:'Triglycerides < 120',l:`Value: ${tg} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcNutrient(p){const vd=p.markers.vit_d.value,b12=p.markers.vit_b12.value,fe=p.markers.iron.value;const bd=[];let sc=0;if(vd<30){sc+=35;bd.push({c:'Vit-D < 30',l:`Value: ${vd} â†’ TRUE`,p:35,s:'rose'})}else if(vd<40){sc+=18;bd.push({c:'Vit-D < 40',l:`Value: ${vd} â†’ TRUE`,p:18,s:'amber'})}else{bd.push({c:'Vit-D > 40',l:`Value: ${vd} â†’ OPTIMAL`,p:0,s:'green'})}if(b12<200){sc+=30;bd.push({c:'B12 < 200',l:`Value: ${b12} â†’ TRUE`,p:30,s:'rose'})}else if(b12<300){sc+=15;bd.push({c:'B12 < 300',l:`Value: ${b12} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'B12 > 300',l:`Value: ${b12} â†’ OPTIMAL`,p:0,s:'green'})}if(fe<60){sc+=30;bd.push({c:'Iron < 60',l:`Value: ${fe} â†’ TRUE`,p:30,s:'rose'})}else if(fe<75){sc+=15;bd.push({c:'Iron < 75',l:`Value: ${fe} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'Iron > 75',l:`Value: ${fe} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcThyroid(p){const co=p.markers.cortisol.value,fe=p.markers.ferritin.value,cr=p.markers.crp.value;const bd=[];let sc=0;if(co>23){sc+=30;bd.push({c:'Cortisol > 23',l:`Value: ${co} â†’ TRUE`,p:30,s:'rose'})}else if(co>19){sc+=15;bd.push({c:'Cortisol > 19',l:`Value: ${co} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'Cortisol < 19',l:`Value: ${co} â†’ OPTIMAL`,p:0,s:'green'})}if(fe>200){sc+=30;bd.push({c:'Ferritin > 200',l:`Value: ${fe} â†’ TRUE`,p:30,s:'rose'})}else if(fe>150){sc+=15;bd.push({c:'Ferritin > 150',l:`Value: ${fe} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'Ferritin < 150',l:`Value: ${fe} â†’ OPTIMAL`,p:0,s:'green'})}if(cr>1){sc+=35;bd.push({c:'CRP > 1.0',l:`Value: ${cr} â†’ TRUE`,p:35,s:'rose'})}else if(cr>0.5){sc+=18;bd.push({c:'CRP > 0.5',l:`Value: ${cr} â†’ TRUE`,p:18,s:'amber'})}else{bd.push({c:'CRP < 0.5',l:`Value: ${cr} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    function calcInflammation(p){const il6=p.inflam.il6,cr=p.markers.crp.value,neu=p.inflam.neutrophils,lym=p.inflam.lymphocytes;const nlr=lym>0?neu/lym:0;const bd=[];let sc=0;if(il6>10){sc+=40;bd.push({c:'IL-6 > 10',l:`Value: ${il6} â†’ TRUE`,p:40,s:'rose'})}else if(il6>5){sc+=20;bd.push({c:'IL-6 > 5',l:`Value: ${il6} â†’ TRUE`,p:20,s:'amber'})}else{bd.push({c:'IL-6 < 5',l:`Value: ${il6} â†’ OPTIMAL`,p:0,s:'green'})}if(cr>3){sc+=30;bd.push({c:'CRP > 3.0',l:`Value: ${cr} â†’ TRUE`,p:30,s:'rose'})}else if(cr>1){sc+=15;bd.push({c:'CRP > 1.0',l:`Value: ${cr} â†’ TRUE`,p:15,s:'amber'})}else{bd.push({c:'CRP < 1.0',l:`Value: ${cr} â†’ OPTIMAL`,p:0,s:'green'})}if(nlr>4){sc+=25;bd.push({c:'NLR > 4.0',l:`Value: ${nlr.toFixed(2)} â†’ TRUE`,p:25,s:'rose'})}else if(nlr>3){sc+=12;bd.push({c:'NLR > 3.0',l:`Value: ${nlr.toFixed(2)} â†’ TRUE`,p:12,s:'amber'})}else{bd.push({c:'NLR < 3.0',l:`Value: ${nlr.toFixed(2)} â†’ OPTIMAL`,p:0,s:'green'})}return{pct:Math.min(sc,95),bd}}

    // Layer 5: Complete Handshake Pathways
    function analyzeHandshakes(){showProcessing('ANALYZING HANDSHAKES','Computing gut-blood correlations...');setTimeout(()=>{unlockLayer(5);const p=PATIENTS[currentPatient];renderHandshakes(p);hideProcessing()},1500)}

    function renderHandshakes(p){document.getElementById('handshake-container').innerHTML=makeMetabolic(p)+makeInflammatory(p)+makeVascular(p)+makeLiver(p)+makeRenal(p)+makeNutrient(p)}

    function makeMetabolic(p){const fi=p.phyla.firmicutes.value,ba=p.phyla.bacteroides.value,homa=p.markers.homa_ir.value;const fiSt=fi>35?'rose':fi>30?'amber':'green',baSt=ba<25?'rose':ba<30?'amber':'green',homaSt=getStatus('homa_ir',homa);let txt=fiSt!=='green'||baSt!=='green'||homaSt!=='green'?`<strong>PATHOLOGICAL:</strong> High Firmicutes (${fi}%) harvest excess calories â†’ Low Bacteroides (${ba}%) fail to burn fat â†’ Results in insulin resistance (HOMA-IR ${homa}). The energy imbalance cascade.`:`<strong>OPTIMAL:</strong> Balanced Firmicutes (${fi}%) â†’ Adequate Bacteroides (${ba}%) â†’ Maintains insulin sensitivity (HOMA-IR ${homa}). Metabolic harmony.`;let outcome=fiSt!=='green'||baSt!=='green'||homaSt!=='green'?`ðŸ”´ <strong>OUTCOME:</strong> Your gut bacteria are extracting too many calories while not burning enough fat, leading to blood sugar control problems.`:`âœ… <strong>OUTCOME:</strong> Your gut bacteria maintain healthy energy balance and blood sugar control.`;return`<div class="handshake-visual"><div class="scan-header"><div class="scan-title">ðŸ”— METABOLIC HANDSHAKE</div><div class="scan-subtitle">Energy Harvesting â†’ Fat Burning â†’ Insulin Control (3-Way Pathway)</div></div><div class="blob-scanner" style="grid-template-columns: 1fr auto 1fr auto 1fr;"><div class="blob-visual"><div class="blob-visual-icon">ðŸ”¥</div><div class="blob-visual-label">HARVESTING</div><div class="blob-visual-name">Firmicutes</div><div class="blob-visual-value ${fiSt}">${fi}%</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Caloric</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ’¨</div><div class="blob-visual-label">BURNING</div><div class="blob-visual-name">Bacteroides</div><div class="blob-visual-value ${baSt}">${ba}%</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Metabolic</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ“Š</div><div class="blob-visual-label">SENSITIVITY</div><div class="blob-visual-name">HOMA-IR</div><div class="blob-visual-value ${homaSt}">${homa}</div></div></div><div class="scan-data"><div class="scan-data-title">ðŸ”¬ 3-WAY PATHWAY ANALYSIS</div><div class="scan-data-text">${txt}</div><div style="margin-top: 16px; padding: 16px; background: rgba(0,0,0,0.4); border-radius: 10px; font-size: 13px; color: #cbd5e1; line-height: 1.7;">${outcome}</div></div></div>`}

    function makeInflammatory(p){const pr=p.phyla.proteobacteria.value,ldh=p.inflam.ldh,crp=p.markers.crp.value;const prSt=getPhylaStatus('proteobacteria',pr),ldhSt=ldh>280?'rose':ldh>220?'amber':'green',crpSt=getStatus('crp',crp);let txt=prSt!=='green'||ldhSt!=='green'||crpSt!=='green'?`<strong>PATHOLOGICAL:</strong> Hazard bacteria overgrowth (Proteobacteria ${pr}%) â†’ Releases endotoxins causing tissue damage (LDH ${ldh}) â†’ Triggers systemic inflammation (CRP ${crp}). The inflammatory cascade.`:`<strong>OPTIMAL:</strong> Hazard bacteria suppressed (Proteobacteria ${pr}%) â†’ Minimal tissue stress (LDH ${ldh}) â†’ Low inflammatory burden (CRP ${crp}). Controlled response.`;let outcome=prSt!=='green'||ldhSt!=='green'||crpSt!=='green'?`ðŸ”´ <strong>OUTCOME:</strong> Bad gut bacteria are releasing toxins that damage your tissues and cause body-wide inflammation.`:`âœ… <strong>OUTCOME:</strong> Your gut bacteria are well-controlled, preventing tissue damage and inflammation.`;return`<div class="handshake-visual"><div class="scan-header"><div class="scan-title">ðŸ”— INFLAMMATORY HANDSHAKE</div><div class="scan-subtitle">Endotoxin Release â†’ Tissue Damage â†’ Systemic Fire (3-Way Pathway)</div></div><div class="blob-scanner" style="grid-template-columns: 1fr auto 1fr auto 1fr;"><div class="blob-visual"><div class="blob-visual-icon">â˜ ï¸</div><div class="blob-visual-label">HAZARD</div><div class="blob-visual-name">Proteobacteria</div><div class="blob-visual-value ${prSt}">${pr}%</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Endotoxin</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ’¥</div><div class="blob-visual-label">DAMAGE</div><div class="blob-visual-name">LDH</div><div class="blob-visual-value ${ldhSt}">${ldh}</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Systemic</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ”¥</div><div class="blob-visual-label">INFLAMMATION</div><div class="blob-visual-name">CRP</div><div class="blob-visual-value ${crpSt}">${crp}</div></div></div><div class="scan-data"><div class="scan-data-title">ðŸ”¬ 3-WAY PATHWAY ANALYSIS</div><div class="scan-data-text">${txt}</div><div style="margin-top: 16px; padding: 16px; background: rgba(0,0,0,0.4); border-radius: 10px; font-size: 13px; color: #cbd5e1; line-height: 1.7;">${outcome}</div></div></div>`}

    function makeVascular(p){const ak=p.phyla.akkermansia.value,alb=p.markers.albumin.value,apob=p.markers.apo_b.value;const akSt=getPhylaStatus('akkermansia',ak),albSt=getStatus('albumin',alb),apobSt=getStatus('apo_b',apob);let txt=akSt!=='green'||albSt!=='green'||apobSt!=='green'?`<strong>PATHOLOGICAL:</strong> Depleted mucosal shield (Akkermansia ${ak}%) â†’ Impaired barrier allows protein leakage (Albumin ${alb}) â†’ Triggers atherogenic particle formation (ApoB ${apob}). The vascular damage pathway.`:`<strong>OPTIMAL:</strong> Robust mucosal barrier (Akkermansia ${ak}%) â†’ Healthy protein levels (Albumin ${alb}) â†’ Prevents particle accumulation (ApoB ${apob}). Protected vessels.`;let outcome=akSt!=='green'||albSt!=='green'||apobSt!=='green'?`ðŸ”´ <strong>OUTCOME:</strong> Your gut barrier is weak, allowing harmful particles into your bloodstream that damage blood vessels.`:`âœ… <strong>OUTCOME:</strong> Your gut barrier is strong, protecting your blood vessels from harmful particles.`;return`<div class="handshake-visual"><div class="scan-header"><div class="scan-title">ðŸ”— VASCULAR HANDSHAKE</div><div class="scan-subtitle">Barrier Integrity â†’ Protein Balance â†’ Particle Control (3-Way Pathway)</div></div><div class="blob-scanner" style="grid-template-columns: 1fr auto 1fr auto 1fr;"><div class="blob-visual"><div class="blob-visual-icon">ðŸ›¡ï¸</div><div class="blob-visual-label">SHIELD</div><div class="blob-visual-name">Akkermansia</div><div class="blob-visual-value ${akSt}">${ak}%</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Barrier</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ§¬</div><div class="blob-visual-label">PROTEIN</div><div class="blob-visual-name">Albumin</div><div class="blob-visual-value ${albSt}">${alb}</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Vascular</div></div><div class="blob-visual"><div class="blob-visual-icon">â¤ï¸</div><div class="blob-visual-label">PARTICLES</div><div class="blob-visual-name">ApoB</div><div class="blob-visual-value ${apobSt}">${apob}</div></div></div><div class="scan-data"><div class="scan-data-title">ðŸ”¬ 3-WAY PATHWAY ANALYSIS</div><div class="scan-data-text">${txt}</div><div style="margin-top: 16px; padding: 16px; background: rgba(0,0,0,0.4); border-radius: 10px; font-size: 13px; color: #cbd5e1; line-height: 1.7;">${outcome}</div></div></div>`}

    function makeLiver(p){const ba=p.phyla.bacteroides.value,tg=p.markers.triglycerides.value,alt=p.markers.alt.value;const baSt=getPhylaStatus('bacteroides',ba),tgSt=getStatus('triglycerides',tg),altSt=getStatus('alt',alt);let txt=baSt!=='green'||tgSt!=='green'||altSt!=='green'?`<strong>PATHOLOGICAL:</strong> Impaired fat burning (Bacteroides ${ba}%) â†’ Causes lipid accumulation (Triglycerides ${tg}) â†’ Results in hepatic stress (ALT ${alt}). The fatty liver cascade.`:`<strong>OPTIMAL:</strong> Efficient fat metabolism (Bacteroides ${ba}%) â†’ Balanced lipids (Triglycerides ${tg}) â†’ Healthy liver function (ALT ${alt}). Metabolic efficiency.`;let outcome=baSt!=='green'||tgSt!=='green'||altSt!=='green'?`ðŸ”´ <strong>OUTCOME:</strong> Your gut bacteria aren't burning fat efficiently, causing fat buildup and liver stress.`:`âœ… <strong>OUTCOME:</strong> Your gut bacteria efficiently burn fat, keeping your liver healthy.`;return`<div class="handshake-visual"><div class="scan-header"><div class="scan-title">ðŸ”— LIVER HANDSHAKE</div><div class="scan-subtitle">Fat Burning â†’ Lipid Balance â†’ Hepatic Function (3-Way Pathway)</div></div><div class="blob-scanner" style="grid-template-columns: 1fr auto 1fr auto 1fr;"><div class="blob-visual"><div class="blob-visual-icon">ðŸ”¥</div><div class="blob-visual-label">BURNING</div><div class="blob-visual-name">Bacteroides</div><div class="blob-visual-value ${baSt}">${ba}%</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Lipid</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ’§</div><div class="blob-visual-label">TRIGLYCERIDES</div><div class="blob-visual-name">TG</div><div class="blob-visual-value ${tgSt}">${tg}</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Hepatic</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ¥</div><div class="blob-visual-label">LIVER</div><div class="blob-visual-name">ALT</div><div class="blob-visual-value ${altSt}">${alt}</div></div></div><div class="scan-data"><div class="scan-data-title">ðŸ”¬ 3-WAY PATHWAY ANALYSIS</div><div class="scan-data-text">${txt}</div><div style="margin-top: 16px; padding: 16px; background: rgba(0,0,0,0.4); border-radius: 10px; font-size: 13px; color: #cbd5e1; line-height: 1.7;">${outcome}</div></div></div>`}

    function makeRenal(p){const ac=p.phyla.actinobacteria.value,bun=p.markers.bun.value,ua=p.markers.uric_acid.value;const acSt=getPhylaStatus('actinobacteria',ac),bunSt=bun>20?'rose':bun>16?'amber':'green',uaSt=getStatus('uric_acid',ua);let txt=acSt!=='green'||bunSt!=='green'||uaSt!=='green'?`<strong>PATHOLOGICAL:</strong> Defense bacteria overactivation (Actinobacteria ${ac}%) â†’ Increases nitrogen waste (BUN ${bun}) â†’ Accumulates as urate crystals (Uric Acid ${ua}). The purine overload pathway.`:`<strong>OPTIMAL:</strong> Defense bacteria balanced (Actinobacteria ${ac}%) â†’ Normal waste processing (BUN ${bun}) â†’ Healthy purine metabolism (Uric Acid ${ua}). Renal efficiency.`;let outcome=acSt!=='green'||bunSt!=='green'||uaSt!=='green'?`ðŸ”´ <strong>OUTCOME:</strong> Your gut bacteria are producing excess waste that's stressing your kidneys and raising uric acid.`:`âœ… <strong>OUTCOME:</strong> Your gut bacteria maintain balanced waste production, keeping your kidneys healthy.`;return`<div class="handshake-visual"><div class="scan-header"><div class="scan-title">ðŸ”— RENAL HANDSHAKE</div><div class="scan-subtitle">Defense Activation â†’ Nitrogen Waste â†’ Urate Accumulation (3-Way Pathway)</div></div><div class="blob-scanner" style="grid-template-columns: 1fr auto 1fr auto 1fr;"><div class="blob-visual"><div class="blob-visual-icon">âš”ï¸</div><div class="blob-visual-label">DEFENSE</div><div class="blob-visual-name">Actinobacteria</div><div class="blob-visual-value ${acSt}">${ac}%</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Nitrogen</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ§ª</div><div class="blob-visual-label">WASTE</div><div class="blob-visual-name">BUN</div><div class="blob-visual-value ${bunSt}">${bun}</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Purine</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ”¬</div><div class="blob-visual-label">FILTRATION</div><div class="blob-visual-name">Uric Acid</div><div class="blob-visual-value ${uaSt}">${ua}</div></div></div><div class="scan-data"><div class="scan-data-title">ðŸ”¬ 3-WAY PATHWAY ANALYSIS</div><div class="scan-data-text">${txt}</div><div style="margin-top: 16px; padding: 16px; background: rgba(0,0,0,0.4); border-radius: 10px; font-size: 13px; color: #cbd5e1; line-height: 1.7;">${outcome}</div></div></div>`}

    function makeNutrient(p){const totDiv=p.phyla.firmicutes.value+p.phyla.bacteroides.value+p.phyla.akkermansia.value+p.phyla.actinobacteria.value+p.phyla.proteobacteria.value;const mag=p.markers.magnesium.value,vitd=p.markers.vit_d.value;const divSt=totDiv>85?'green':totDiv>75?'amber':'rose',magSt=getStatus('magnesium',mag),vdSt=getStatus('vit_d',vitd);let txt=divSt!=='green'||magSt!=='green'||vdSt!=='green'?`<strong>PATHOLOGICAL:</strong> Low microbial diversity (${totDiv.toFixed(1)}%) â†’ Impairs mineral absorption (Magnesium ${mag}) â†’ Reduces vitamin synthesis (Vit-D ${vitd}). The nutrient depletion cascade.`:`<strong>OPTIMAL:</strong> Robust microbial diversity (${totDiv.toFixed(1)}%) â†’ Supports mineral balance (Magnesium ${mag}) â†’ Enables vitamin production (Vit-D ${vitd}). Nutrient synergy.`;let outcome=divSt!=='green'||magSt!=='green'||vdSt!=='green'?`ðŸ”´ <strong>OUTCOME:</strong> Low gut bacteria diversity is impairing your body's ability to absorb minerals and make vitamins.`:`âœ… <strong>OUTCOME:</strong> Diverse gut bacteria help your body absorb minerals and produce vitamins effectively.`;return`<div class="handshake-visual"><div class="scan-header"><div class="scan-title">ðŸ”— NUTRIENT HANDSHAKE</div><div class="scan-subtitle">Diversity â†’ Mineral Absorption â†’ Vitamin Synthesis (3-Way Pathway)</div></div><div class="blob-scanner" style="grid-template-columns: 1fr auto 1fr auto 1fr;"><div class="blob-visual"><div class="blob-visual-icon">ðŸŒˆ</div><div class="blob-visual-label">DIVERSITY</div><div class="blob-visual-name">Total Phyla</div><div class="blob-visual-value ${divSt}">${totDiv.toFixed(1)}%</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Absorption</div></div><div class="blob-visual"><div class="blob-visual-icon">âš¡</div><div class="blob-visual-label">MINERAL</div><div class="blob-visual-name">Magnesium</div><div class="blob-visual-value ${magSt}">${mag}</div></div><div><div class="connector-arrow">â†’</div><div class="connector-label">Synthesis</div></div><div class="blob-visual"><div class="blob-visual-icon">ðŸ§¬</div><div class="blob-visual-label">VITAMIN</div><div class="blob-visual-name">Vit-D</div><div class="blob-visual-value ${vdSt}">${vitd}</div></div></div><div class="scan-data"><div class="scan-data-title">ðŸ”¬ 3-WAY PATHWAY ANALYSIS</div><div class="scan-data-text">${txt}</div><div style="margin-top: 16px; padding: 16px; background: rgba(0,0,0,0.4); border-radius: 10px; font-size: 13px; color: #cbd5e1; line-height: 1.7;">${outcome}</div></div></div>`}

    // Layer 6: AI Diagnostic

    // LAYER 7: ADVANCED ANALYTICS FUNCTIONS
    
    // Calculate GCC Score (needed for analytics)
    function calculateGCC(p){
        if(!p || !p.markers) return {score: 0, grade: 'F'};
        const m=p.markers;
        let tot=0;
        GCC_MARKERS.forEach(id=>{
            if(m[id] && m[id].value !== undefined) {
                const st=getStatus(id,m[id].value);
                if(st==='green')tot+=100;
                else if(st==='amber')tot+=50;
            }
        });
        const sc=Math.round(tot/600*100);
        let gr='F';
        if(sc>=90)gr='A+';
        else if(sc>=80)gr='A';
        else if(sc>=70)gr='B';
        else if(sc>=60)gr='C';
        else if(sc>=50)gr='D';
        return{score:sc,grade:gr};
    }
    
    function getMetabolicScore(p){
        if(!p || !p.markers) return 50;
        const m=p.markers;
        let score=100;
        if(m.hba1c && m.hba1c.value>5.7)score-=(m.hba1c.value-5.7)*10;
        if(m.triglycerides && m.triglycerides.value>150)score-=(m.triglycerides.value-150)*0.2;
        if(m.homa_ir && m.homa_ir.value>2)score-=(m.homa_ir.value-2)*8;
        return Math.max(0,Math.min(100,score));
    }
    
    function getInflammationScore(p){
        if(!p || !p.markers || !p.inflam) return 50;
        const m=p.markers;
        let score=100;
        if(m.crp && m.crp.value>1)score-=(m.crp.value-1)*4;
        if(p.inflam.il6 && p.inflam.il6>5)score-=(p.inflam.il6-5)*3;
        if(m.ferritin && m.ferritin.value>200)score-=(m.ferritin.value-200)*0.1;
        return Math.max(0,Math.min(100,score));
    }
    
    function getMicrobiomeScore(p){
        if(!p || !p.phyla) return 50;
        const total=(p.phyla.firmicutes?.value || 0)+(p.phyla.bacteroides?.value || 0)+(p.phyla.actinobacteria?.value || 0)+(p.phyla.proteobacteria?.value || 0)+(p.phyla.akkermansia?.value || 0);
        let score=total>85?90:total>75?70:50;
        if((p.phyla.proteobacteria?.value || 0)>5)score-=15;
        if((p.phyla.akkermansia?.value || 0)<5)score-=10;
        return Math.max(0,Math.min(100,score));
    }
    
    function buildScoreRings(p){
        const scores=[
            {label:"GCC Score",value:calculateGCC(p).score,max:100,ref:"90+ Excellent | 70-89 Good | 50-69 Fair | <50 Poor",desc:"Critical biomarkers health grade"},
            {label:"Inflammation",value:getInflammationScore(p),max:100,ref:"70+ Low | 40-69 Moderate | <40 High",desc:"Systemic inflammation burden"},
            {label:"Metabolic",value:getMetabolicScore(p),max:100,ref:"70+ Optimal | 40-69 At Risk | <40 Dysfunction",desc:"Blood sugar & fat metabolism"},
            {label:"Microbiome",value:getMicrobiomeScore(p),max:100,ref:"70+ Balanced | 40-69 Imbalanced | <40 Dysbiotic",desc:"Gut bacteria health status"}
        ];
        let html='';
        scores.forEach(s=>{
            const circumference=2*Math.PI*80;
            const offset=circumference-(s.value/s.max)*circumference;
            
            let ringColor, textColorClass, statusText;
            if(s.value >= 70) {
                ringColor = '#34d399';
                textColorClass = 'green';
                statusText = 'OPTIMAL';
            } else if(s.value >= 40) {
                ringColor = '#fbbf24';
                textColorClass = 'amber';
                statusText = 'WARNING';
            } else {
                ringColor = '#fb7185';
                textColorClass = 'rose';
                statusText = 'CRITICAL';
            }
            
            html+=`<div><div class="score-ring"><svg class="ring-svg" viewBox="0 0 180 180"><circle class="ring-bg" cx="90" cy="90" r="80"></circle><circle class="ring-progress" cx="90" cy="90" r="80" stroke="${ringColor}" stroke-dasharray="${circumference}" stroke-dashoffset="${offset}"></circle></svg><div class="ring-content"><div class="ring-score ${textColorClass}">${Math.round(s.value)}</div><div class="ring-label">${s.label}</div><div class="ring-status ${textColorClass}">${statusText}</div></div></div><div style="margin-top:8px; font-size:9px; color:var(--text-muted); text-align:center; line-height:1.3;"><div style="color:#94a3b8; margin-bottom:2px;">${s.desc}</div><div>${s.ref}</div></div></div>`;
        });
        document.getElementById('score-rings').innerHTML=html;
    }
    
    
    // BUILD 2: Interactive Network Graph (WOW FACTOR)
    let activeNode = null;
    function buildNetworkGraph(p) {
        if(!p || !p.markers) {
            document.getElementById('network-graph').innerHTML = '<div style="padding:40px;text-align:center;color:var(--text-muted);">Patient data not available</div>';
            return;
        }
        
        // Get actual patient values for dynamic network strength calculation
        const hba1c = p.markers.hba1c?.value || 5.0;
        const homaIR = p.markers.homa_ir?.value || 1.5;
        const crp = p.markers.crp?.value || 0.5;
        const il6 = p.inflam?.il6 || 2.0;
        
        // Calculate dynamic connection strengths based on patient state
        const metabolicStress = (hba1c > 5.7 ? 0.3 : 0) + (homaIR > 2 ? 0.4 : 0);
        const inflammStress = (crp > 1 ? 0.3 : 0) + (il6 > 5 ? 0.3 : 0);
        const totalStress = metabolicStress + inflammStress;
        
        const markers = [
            {id: 'hba1c', name: 'HbA1c', cat: 'metabolic', color: '#3b82f6'},
            {id: 'homa_ir', name: 'HOMA-IR', cat: 'metabolic', color: '#3b82f6'},
            {id: 'triglycerides', name: 'Trigly-cerides', cat: 'metabolic', color: '#3b82f6'},
            {id: 'hdl', name: 'HDL', cat: 'metabolic', color: '#3b82f6'},
            {id: 'crp', name: 'CRP', cat: 'inflammation', color: '#ef4444'},
            {id: 'ferritin', name: 'Ferritin', cat: 'inflammation', color: '#ef4444'},
            {id: 'il6', name: 'IL-6', cat: 'inflammation', color: '#ef4444'},
            {id: 'akkermansia', name: 'Akkermansia', cat: 'microbiome', color: '#10b981'},
            {id: 'firmicutes', name: 'Firmicutes', cat: 'microbiome', color: '#10b981'},
            {id: 'alt', name: 'ALT', cat: 'liver', color: '#8b5cf6'},
            {id: 'ast', name: 'AST', cat: 'liver', color: '#8b5cf6'},
            {id: 'cortisol', name: 'Cortisol', cat: 'inflammation', color: '#ef4444'}
        ];

        const positions = [
            {x: 150, y: 100}, {x: 350, y: 80}, {x: 550, y: 100}, {x: 750, y: 80},
            {x: 100, y: 280}, {x: 300, y: 300}, {x: 500, y: 280}, {x: 700, y: 300},
            {x: 250, y: 450}, {x: 450, y: 470}, {x: 650, y: 450}, {x: 400, y: 200}
        ];

        const connections = [
            {from: 0, to: 1, strength: 0.85}, {from: 1, to: 2, strength: 0.72},
            {from: 2, to: 3, strength: -0.68}, {from: 4, to: 5, strength: 0.75},
            {from: 4, to: 6, strength: 0.82}, {from: 7, to: 1, strength: -0.60},
            {from: 8, to: 2, strength: 0.55}, {from: 9, to: 10, strength: 0.70},
            {from: 11, to: 4, strength: 0.65}
        ];
        
        // Better calculation: percentage of strong connections
        const numConnections = connections.length;
        const strongConnections = connections.filter(c => Math.abs(c.strength) > 0.7).length;
        const strongPercent = (strongConnections / numConnections) * 100;
        
        // Determine network state based on PERCENTAGE and patient stress
        let networkState, networkColor, networkInterpretation;
        if (strongPercent >= 60 || totalStress > 0.6) {
            networkState = 'HIGHLY COORDINATED';
            networkColor = '#ef4444';
            networkInterpretation = 'Your biomarkers are tightly linked - changes in one area cascade through others. Comprehensive intervention needed targeting multiple systems simultaneously.';
        } else if (strongPercent >= 40 || totalStress > 0.3) {
            networkState = 'MODERATELY LINKED';
            networkColor = '#f59e0b';
            networkInterpretation = 'Some biomarkers influence each other. Focus interventions on key nodes (gut health, inflammation) to create positive ripple effects across connected markers.';
        } else {
            networkState = 'WEAKLY COORDINATED';
            networkColor = '#10b981';
            networkInterpretation = 'Your biomarkers are relatively independent. Each system can be addressed separately - improvements in one area unlikely to affect others significantly.';
        }

        let html = `
        <div style="margin-bottom:20px; padding:16px; background:rgba(30,41,59,0.5); border-radius:12px; border:1px solid rgba(148,163,184,0.15);">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:14px;">
                <div style="padding:12px; background:rgba(59,130,246,0.08); border-radius:8px; border-left:3px solid ${networkColor};">
                    <div style="font-size:10px; color:var(--text-muted); margin-bottom:4px; font-weight:700;">NETWORK STATE</div>
                    <div style="font-size:15px; font-weight:900; color:${networkColor}; margin-bottom:6px;">${networkState}</div>
                    <div style="font-size:10px; color:#94a3b8;">${strongConnections} strong links (${Math.round(strongPercent)}%)</div>
                </div>
                
                <div style="padding:12px; background:rgba(59,130,246,0.08); border-radius:8px; border-left:3px solid #8b5cf6;">
                    <div style="font-size:10px; color:var(--text-muted); margin-bottom:4px; font-weight:700;">INTERPRETATION</div>
                    <div style="font-size:10px; color:#cbd5e1; line-height:1.5;">${networkInterpretation}</div>
                </div>
            </div>
            
            <div style="padding:10px; background:rgba(139,92,246,0.06); border-radius:8px; border-left:3px solid #8b5cf6;">
                <div style="font-size:10px; font-weight:700; color:#c4b5fd; margin-bottom:6px;">ðŸ“Š 12 Master Biomarkers Selected</div>
                <div style="font-size:10px; color:#94a3b8; line-height:1.5;">
                    From 41 total markers, these 12 are: <strong style="color:#cbd5e1;">(1)</strong> Core disease drivers, <strong style="color:#cbd5e1;">(2)</strong> Handshake pathway members, <strong style="color:#cbd5e1;">(3)</strong> Most interconnected across systems
                </div>
            </div>
        </div>
        
        <div style="display:flex; gap:12px; margin-bottom:14px; font-size:10px; flex-wrap:wrap; align-items:center;">
            <div style="display:flex; align-items:center; gap:5px;"><div style="width:10px; height:10px; background:#3b82f6; border-radius:50%;"></div><span style="color:var(--text-muted);">Metabolic (4)</span></div>
            <div style="display:flex; align-items:center; gap:5px;"><div style="width:10px; height:10px; background:#ef4444; border-radius:50%;"></div><span style="color:var(--text-muted);">Inflammation (4)</span></div>
            <div style="display:flex; align-items:center; gap:5px;"><div style="width:10px; height:10px; background:#10b981; border-radius:50%;"></div><span style="color:var(--text-muted);">Microbiome (2)</span></div>
            <div style="display:flex; align-items:center; gap:5px;"><div style="width:10px; height:10px; background:#8b5cf6; border-radius:50%;"></div><span style="color:var(--text-muted);">Liver/Kidney (2)</span></div>
            <div style="flex:1;"></div>
            <div style="padding:4px 10px; background:rgba(59,130,246,0.15); border-radius:6px; color:#60a5fa; font-weight:700; font-size:9px;">Click nodes to explore connections</div>
        </div>
        
        <div style="position:relative; height:550px; background:rgba(0,0,0,0.2); border-radius:12px; overflow:hidden; border:1px solid rgba(148,163,184,0.1);">`;
        
        connections.forEach(c => {
            const from = positions[c.from];
            const to = positions[c.to];
            const dx = to.x - from.x;
            const dy = to.y - from.y;
            const length = Math.sqrt(dx*dx + dy*dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            const strong = Math.abs(c.strength) > 0.7 ? ' strong' : '';
            html += `<div class="network-edge${strong}" id="edge-${c.from}-${c.to}" 
                style="left:${from.x}px; top:${from.y}px; width:${length}px; 
                transform:rotate(${angle}deg);"></div>`;
        });

        markers.forEach((m, i) => {
            html += `<div class="network-node" id="node-${i}"
                style="left:${positions[i].x-40}px; top:${positions[i].y-40}px; 
                background:${m.color}22; border-color:${m.color}; color:${m.color};"
                onclick="toggleNode(${i})" data-connections="${connections.filter(c => c.from === i || c.to === i).map(c => c.from === i ? c.to : c.from).join(',')}">${m.name}</div>`;
        });

        html += '</div>';
        document.getElementById('network-graph').innerHTML = html;
    }

    function toggleNode(nodeId) {
        const node = document.getElementById(`node-${nodeId}`);
        const connections = node.dataset.connections.split(',').filter(x => x);
        document.querySelectorAll('.network-node').forEach(n => n.classList.remove('active'));
        document.querySelectorAll('.network-edge').forEach(e => e.classList.remove('active'));
        if (activeNode === nodeId) { activeNode = null; return; }
        node.classList.add('active');
        activeNode = nodeId;
        connections.forEach(connId => {
            document.getElementById(`node-${connId}`)?.classList.add('active');
            document.getElementById(`edge-${nodeId}-${connId}`)?.classList.add('active');
            document.getElementById(`edge-${connId}-${nodeId}`)?.classList.add('active');
        });
    }

    // BUILD 5: What-If Simulator (WOW FACTOR)
    function buildSimulator(p) {
        const sliders = [
            {id: 'hba1c', label: 'HbA1c (%)', min: 4, max: 12, step: 0.1, value: p.markers.hba1c.value},
            {id: 'crp', label: 'CRP (mg/L)', min: 0, max: 20, step: 0.1, value: p.markers.crp.value},
            {id: 'homa_ir', label: 'HOMA-IR', min: 0.5, max: 10, step: 0.1, value: p.markers.homa_ir.value},
            {id: 'triglycerides', label: 'Triglycerides (mg/dL)', min: 50, max: 400, step: 5, value: p.markers.triglycerides.value},
            {id: 'hdl', label: 'HDL (mg/dL)', min: 20, max: 100, step: 1, value: p.markers.hdl.value},
            {id: 'ferritin', label: 'Ferritin (ng/mL)', min: 20, max: 500, step: 5, value: p.markers.ferritin.value}
        ];

        let controlsHTML = '';
        sliders.forEach(s => {
            controlsHTML += `<div class="slider-group"><div class="slider-label"><span class="slider-name">${s.label}</span><span class="slider-value" id="sim-${s.id}-val">${s.value.toFixed(1)}</span></div><input type="range" class="slider" min="${s.min}" max="${s.max}" step="${s.step}" value="${s.value}" id="sim-${s.id}" oninput="updateSimulation()"></div>`;
        });
        controlsHTML += `<div class="sim-buttons"><button class="sim-btn" onclick="resetSimulation()">â†º Reset</button><button class="sim-btn" onclick="setBestCase()">âœ“ Best Case</button><button class="sim-btn" onclick="setWorstCase()">âš  Worst Case</button></div>`;
        document.getElementById('sim-controls').innerHTML = controlsHTML;
        updateSimulation();
    }

    function updateSimulation() {
        ['hba1c', 'crp', 'homa_ir', 'triglycerides', 'hdl', 'ferritin'].forEach(id => {
            const slider = document.getElementById(`sim-${id}`);
            const display = document.getElementById(`sim-${id}-val`);
            if (slider && display) display.textContent = parseFloat(slider.value).toFixed(1);
        });
        const simMarkers = {
            hba1c: {value: parseFloat(document.getElementById('sim-hba1c')?.value || 5.2)},
            crp: {value: parseFloat(document.getElementById('sim-crp')?.value || 0.4)},
            homa_ir: {value: parseFloat(document.getElementById('sim-homa_ir')?.value || 1.2)},
            triglycerides: {value: parseFloat(document.getElementById('sim-triglycerides')?.value || 80)},
            hdl: {value: parseFloat(document.getElementById('sim-hdl')?.value || 65)},
            ferritin: {value: parseFloat(document.getElementById('sim-ferritin')?.value || 75)}
        };
        const gccResult = calculateGCC({markers: simMarkers});
        const gcc = gccResult.score;
        const metabolic = getMetabolicScore({markers: simMarkers});
        const inflammation = getInflammationScore({markers: simMarkers, inflam: PATIENTS[currentPatient].inflam});
        const resultsHTML = `<div class="sim-result-card"><div class="sim-result-label">GCC Score</div><div class="sim-result-value ${gcc >= 70 ? 'green' : gcc >= 40 ? 'amber' : 'rose'}">${Math.round(gcc)}</div></div><div class="sim-result-card"><div class="sim-result-label">Metabolic Health</div><div class="sim-result-value ${metabolic >= 70 ? 'green' : 'amber'}">${Math.round(metabolic)}</div></div><div class="sim-result-card"><div class="sim-result-label">Inflammation State</div><div class="sim-result-value ${inflammation >= 70 ? 'green' : 'rose'}">${Math.round(inflammation)}</div></div>`;
        document.getElementById('sim-results').innerHTML = resultsHTML;
    }

    function resetSimulation() {
        const p = PATIENTS[currentPatient].markers;
        document.getElementById('sim-hba1c').value = p.hba1c.value;
        document.getElementById('sim-crp').value = p.crp.value;
        document.getElementById('sim-homa_ir').value = p.homa_ir.value;
        document.getElementById('sim-triglycerides').value = p.triglycerides.value;
        document.getElementById('sim-hdl').value = p.hdl.value;
        document.getElementById('sim-ferritin').value = p.ferritin.value;
        updateSimulation();
    }

    function setBestCase() {
        document.getElementById('sim-hba1c').value = 5.0;
        document.getElementById('sim-crp').value = 0.3;
        document.getElementById('sim-homa_ir').value = 1.0;
        document.getElementById('sim-triglycerides').value = 70;
        document.getElementById('sim-hdl').value = 70;
        document.getElementById('sim-ferritin').value = 80;
        updateSimulation();
    }

    function setWorstCase() {
        document.getElementById('sim-hba1c').value = 9.0;
        document.getElementById('sim-crp').value = 15;
        document.getElementById('sim-homa_ir').value = 8.0;
        document.getElementById('sim-triglycerides').value = 350;
        document.getElementById('sim-hdl').value = 30;
        document.getElementById('sim-ferritin').value = 400;
        updateSimulation();
    }

    // INFLAMMATION DASHBOARD - Complete rewrite with disease context and forced colors
    function buildInflammationDashboard(p) {
        if(!p || !p.markers || !p.inflam) {
            document.getElementById('inflam-dashboard').innerHTML = '<div style="color:var(--text-muted);padding:40px;text-align:center;">Inflammation data not available</div>';
            return;
        }
        const m = p.markers;
        const inf = p.inflam;
        const nlr = ((inf.neutrophils || 0) / (inf.lymphocytes || 1)).toFixed(2);
        const plr = ((inf.platelets || 0) / (inf.lymphocytes || 1)).toFixed(1);
        const sii = Math.round(((inf.platelets || 0) * (inf.neutrophils || 0)) / (inf.lymphocytes || 1));

        const indices = [
            {
                title: 'NLR (Neutrophil-Lymphocyte)', 
                value: nlr, 
                calc: `${inf.neutrophils}% Ã· ${inf.lymphocytes}% = ${nlr}`,
                max: 10, 
                status: parseFloat(nlr) < 3 ? 'Optimal' : parseFloat(nlr) < 5 ? 'Warning' : 'Critical', 
                ref: 'Optimal <3 | Warning 3-5 | Critical >5',
                disease: 'CVD Risk, Cancer, Infections - High NLR predicts cardiovascular events and active malignancy',
                why: 'Compares infection-fighting cells to immune cells. Imbalance indicates chronic inflammation.'
            },
            {
                title: 'PLR (Platelet-Lymphocyte)', 
                value: plr, 
                calc: `${inf.platelets} Ã· ${inf.lymphocytes}% = ${plr}`,
                max: 300, 
                status: parseFloat(plr) < 150 ? 'Optimal' : parseFloat(plr) < 200 ? 'Warning' : 'Critical', 
                ref: 'Optimal <150 | Warning 150-200 | Critical >200',
                disease: 'Cancer Prognosis, Thrombosis - Elevated PLR indicates worse outcomes and clotting risk',
                why: 'Reflects inflammatory state and clotting potential. High values increase cardiovascular risk.'
            },
            {
                title: 'SII (Systemic Inflammation)', 
                value: sii, 
                calc: `(${inf.platelets} Ã— ${inf.neutrophils}%) Ã· ${inf.lymphocytes}% = ${sii}`,
                max: 2000, 
                status: sii < 500 ? 'Optimal' : sii < 900 ? 'Warning' : 'Critical', 
                ref: 'Optimal <500 | Warning 500-900 | Critical >900',
                disease: 'Cancer, CVD, Infections - High SII predicts poor survival and heart attack risk',
                why: 'Combines three markers for comprehensive inflammation picture. More sensitive than single markers.'
            },
            {
                title: 'CRP (C-Reactive Protein)', 
                value: (m.crp?.value || 0).toFixed(1) + ' mg/L', 
                calc: 'Direct lab measurement',
                max: 20, 
                status: (m.crp?.value || 0) < 1 ? 'Optimal' : (m.crp?.value || 0) < 3 ? 'Warning' : 'Critical', 
                ref: 'Optimal <1 | Warning 1-3 | Critical >3',
                disease: 'CVD, Infections, IBD - Values over 3 mg/L double heart attack risk',
                why: 'Gold standard marker for systemic inflammation. Liver produces CRP in response to inflammation.'
            },
            {
                title: 'IL-6 (Interleukin-6)', 
                value: (inf.il6 || 0).toFixed(1) + ' pg/mL', 
                calc: 'Direct lab measurement',
                max: 25, 
                status: (inf.il6 || 0) < 5 ? 'Optimal' : 'Critical', 
                ref: 'Optimal <5 | Critical >5',
                disease: 'Cytokine Storm, Cancer, Autoimmune - Master inflammatory cytokine',
                why: 'Triggers cascade of other inflammatory molecules. Directly causes fever and tissue damage.'
            },
            {
                title: 'Ferritin (Iron Storage)', 
                value: Math.round(m.ferritin?.value || 0) + ' ng/mL', 
                calc: 'Direct lab measurement',
                max: 500, 
                status: (m.ferritin?.value || 0) < 200 ? 'Optimal' : 'Critical', 
                ref: 'Optimal <200 | Critical >200',
                disease: 'Hemochromatosis, Chronic Inflammation - Elevated in IBD and RA',
                why: 'Iron storage protein that also rises with inflammation. Elevated means excess iron OR inflammation.'
            }
        ];

        let html = '<div style="margin-bottom:14px; padding:10px 14px; background:rgba(139,92,246,0.06); border-radius:8px; border-left:3px solid #8b5cf6;"><div style="font-size:10px; font-weight:700; color:#c4b5fd; margin-bottom:4px;">ðŸ’¡ Composite Inflammation Indices</div><div style="font-size:9px; color:#94a3b8; line-height:1.5;">These composite indices combine protein markers and cellular counts to reveal inflammatory patterns invisible to standard bloodwork.</div></div>';
        
        indices.forEach(ind => {
            const numValue = parseFloat(ind.value);
            const barPercent = Math.min((numValue / ind.max) * 100, 100);
            
            let bgColor, textColor, borderColor;
            if (ind.status === 'Optimal') {
                bgColor = 'rgba(52,211,153,0.15)';
                textColor = '#34d399';
                borderColor = '#34d399';
            } else if (ind.status === 'Warning') {
                bgColor = 'rgba(251,191,36,0.15)';
                textColor = '#fbbf24';
                borderColor = '#fbbf24';
            } else {
                bgColor = 'rgba(251,113,133,0.15)';
                textColor = '#fb7185';
                borderColor = '#fb7185';
            }
            
            html += `<div style="background:var(--bg-card); border-radius:10px; padding:16px; border:1px solid var(--border); margin-bottom:10px;">
                <div style="font-size:10px; font-weight:800; color:var(--text-muted); margin-bottom:8px; letter-spacing:0.5px;">${ind.title}</div>
                <div style="font-size:26px; font-weight:900; margin-bottom:6px; font-family:'JetBrains Mono'; color:#60a5fa;">${ind.value}</div>
                <div style="padding:4px 10px; border-radius:6px; font-size:10px; font-weight:700; display:inline-block; margin-bottom:6px; background:${bgColor}; color:${textColor}; border:1px solid ${borderColor};">${ind.status}</div>
                <div style="font-size:9px; color:#64748b; font-family:'JetBrains Mono'; margin-bottom:8px; font-style:italic;">${ind.calc}</div>
                <div style="height:5px; background:rgba(255,255,255,0.05); border-radius:3px; overflow:hidden; margin-bottom:8px;"><div style="height:100%; width:${barPercent}%; background:linear-gradient(90deg, #34d399 0%, #fbbf24 50%, #fb7185 100%); transition:width 0.6s ease;"></div></div>
                <div style="margin-top:8px; padding-top:8px; border-top:1px solid rgba(148,163,184,0.08);">
                    <div style="font-size:9px; color:${textColor}; margin-bottom:4px; line-height:1.3; font-weight:600;">${ind.ref}</div>
                    <div style="font-size:8px; color:#94a3b8; margin-bottom:3px; line-height:1.4;">${ind.why}</div>
                    <div style="font-size:8px; color:#94a3b8; line-height:1.4;">${ind.disease}</div>
                </div>
            </div>`;
        });

        document.getElementById('inflam-dashboard').innerHTML = html;
    }

    // BUILDS 3,4,6,8,9,10: Additional Analytics (Simple Blobs)
    function buildAdditionalAnalytics(p) {
        if(!p || !p.markers || !p.phyla) {
            document.getElementById('additional-analytics').innerHTML = '<div style="color:var(--text-muted);padding:40px;text-align:center;">Data not available</div>';
            return;
        }
        const m = p.markers;
        const phyla = [
            (p.phyla.firmicutes?.value || 0) / 100, 
            (p.phyla.bacteroides?.value || 0) / 100, 
            (p.phyla.actinobacteria?.value || 0) / 100, 
            (p.phyla.proteobacteria?.value || 0) / 100, 
            (p.phyla.akkermansia?.value || 0) / 100
        ];
        let shannon = 0;
        phyla.forEach(pi => { if (pi > 0) shannon -= pi * Math.log(pi); });
        let bioAge = p.age || 0;
        if (m.crp?.value > 3) bioAge += (m.crp.value - 3) * 0.8;
        if (m.ferritin?.value > 200) bioAge += (m.ferritin.value - 200) * 0.015;
        let t2dRisk = 0;
        if (m.hba1c?.value > 5.7) t2dRisk += (m.hba1c.value - 5.7) * 15;
        if (m.homa_ir?.value > 2.5) t2dRisk += (m.homa_ir.value - 2.5) * 10;
        t2dRisk = Math.min(95, Math.max(5, t2dRisk));

        const firmValue = p.phyla.firmicutes?.value || 1;
        const bactValue = p.phyla.bacteroides?.value || 1;
        const fbRatio = (firmValue / bactValue).toFixed(2);

        const cards = [
            {title: 'Shannon Diversity (B3)', value: shannon.toFixed(2), status: shannon > 2 ? 'Good Diversity' : 'Low Diversity'},
            {title: 'Phenotype (B4)', value: getMetabolicScore(p) > 70 ? 'OPTIMAL' : 'AT RISK', status: 'Classified'},
            {title: 'Biological Age (B6)', value: Math.round(bioAge) + ' yrs', status: bioAge > (p.age || 0) ? `+${Math.round(bioAge - (p.age || 0))} years` : 'Optimal'},
            {title: 'F:B Ratio (B8)', value: fbRatio, status: 'Microbiome Balance'},
            {title: 'Dysbiosis Score (B8)', value: Math.round(((p.phyla.proteobacteria?.value || 0) > 5 ? 30 : 0) + ((p.phyla.akkermansia?.value || 0) < 5 ? 20 : 0)), status: 'Gut Health'},
            {title: '5-Yr T2D Risk (B9)', value: Math.round(t2dRisk) + '%', status: t2dRisk < 30 ? 'Low Risk' : 'Elevated'},
            {title: 'CVD Risk (B9)', value: Math.round(Math.min(50, ((m.ldl?.value || 100) - 100) * 0.5 + ((m.crp?.value || 0) > 3 ? ((m.crp?.value || 0) - 3) * 3 : 0))) + '%', status: 'Calculated'},
            {title: 'Trend Analysis (B10)', value: 'N/A', status: 'Need Longitudinal Data'},
            {title: 'PCA Position (B3)', value: 'Quadrant ' + (currentPatient + 1), status: 'Health Space Mapping'}
        ];

        let html = '';
        cards.forEach(card => {
            html += `<div class="simple-card"><div class="simple-card-title">${card.title}</div><div class="simple-card-value">${card.value}</div><div class="simple-card-status">${card.status}</div></div>`;
        });

        document.getElementById('additional-analytics').innerHTML = html;
    }
    
    function renderAdvancedAnalytics(){
        const p=PATIENTS[currentPatient];
        buildScoreRings(p);
        buildNetworkGraph(p);
        buildInflammationDashboard(p);
        buildCoreMetrics(p);
    }
    
    // BUILD ONLY 3 CORE METRICS - Shannon, F:B Ratio, Dysbiosis
    function buildCoreMetrics(p) {
        if(!p || !p.phyla) {
            document.getElementById('core-metrics').innerHTML = '<div style="padding:40px;text-align:center;color:var(--text-muted);">Microbiome data not available</div>';
            return;
        }
        
        // Calculate Shannon Diversity
        const phyla = [
            (p.phyla.firmicutes?.value || 0) / 100,
            (p.phyla.bacteroides?.value || 0) / 100,
            (p.phyla.actinobacteria?.value || 0) / 100,
            (p.phyla.proteobacteria?.value || 0) / 100,
            (p.phyla.akkermansia?.value || 0) / 100
        ];
        let shannon = 0;
        phyla.forEach(pi => { if (pi > 0) shannon -= pi * Math.log(pi); });
        
        // Calculate F:B Ratio
        const firmValue = p.phyla.firmicutes?.value || 1;
        const bactValue = p.phyla.bacteroides?.value || 1;
        const fbRatio = (firmValue / bactValue).toFixed(2);
        
        // Calculate Dysbiosis Score
        const dysbiosis = Math.round(
            ((p.phyla.proteobacteria?.value || 0) > 5 ? 30 : 0) +
            ((p.phyla.akkermansia?.value || 0) < 5 ? 20 : 0)
        );
        
        // Determine statuses
        const shannonStatus = shannon > 2 ? 'green' : shannon > 1.5 ? 'amber' : 'rose';
        const shannonText = shannon > 2 ? 'Good Diversity' : shannon > 1.5 ? 'Moderate Diversity' : 'Low Diversity';
        
        const fbStatus = fbRatio < 1 ? 'green' : fbRatio < 1.5 ? 'amber' : 'rose';
        const fbText = fbRatio < 1 ? 'Optimal Balance' : fbRatio < 1.5 ? 'Moderate Imbalance' : 'Significant Imbalance';
        
        const dysStatus = dysbiosis === 0 ? 'green' : dysbiosis < 30 ? 'amber' : 'rose';
        const dysText = dysbiosis === 0 ? 'Healthy Gut' : dysbiosis < 30 ? 'Mild Dysbiosis' : 'Moderate Dysbiosis';
        
        const html = `
            <div class="core-metric-card">
                <div class="core-metric-title">ðŸ§¬ Shannon Diversity Index</div>
                <div class="core-metric-value ${shannonStatus}">${shannon.toFixed(2)}</div>
                <div class="core-metric-status ${shannonStatus}">${shannonText}</div>
                <div class="core-metric-description">
                    <div style="font-size:10px; color:#94a3b8; margin-bottom:4px;">Measures microbial species richness and evenness</div>
                    <div style="font-size:9px; color:var(--text-muted);">Optimal >2.0 | Moderate 1.5-2.0 | Low &lt;1.5</div>
                </div>
            </div>
            
            <div class="core-metric-card">
                <div class="core-metric-title">âš–ï¸ Firmicutes:Bacteroidetes Ratio</div>
                <div class="core-metric-value ${fbStatus}">${fbRatio}</div>
                <div class="core-metric-status ${fbStatus}">${fbText}</div>
                <div class="core-metric-description">
                    <div style="font-size:10px; color:#94a3b8; margin-bottom:4px;">Balance between major gut bacteria groups</div>
                    <div style="font-size:9px; color:var(--text-muted);">Optimal &lt;1.0 | Acceptable 1.0-1.5 | High &gt;1.5</div>
                </div>
            </div>
            
            <div class="core-metric-card">
                <div class="core-metric-title">ðŸ¦  Dysbiosis Score</div>
                <div class="core-metric-value ${dysStatus}">${dysbiosis}</div>
                <div class="core-metric-status ${dysStatus}">${dysText}</div>
                <div class="core-metric-description">
                    <div style="font-size:10px; color:#94a3b8; margin-bottom:4px;">Gut imbalance combining harmful and beneficial bacteria</div>
                    <div style="font-size:9px; color:var(--text-muted);">Healthy 0 | Mild 1-29 | Moderate 30-50</div>
                </div>
            </div>
        `;
        
        document.getElementById('core-metrics').innerHTML = html;
    }

    function renderDiagnostic(){
        const p = PATIENTS[currentPatient];
        const gccData = calculateGCC(p);
        
        document.getElementById('diagnostic-container').innerHTML = `
            <div style="text-align:center; padding:80px 40px; max-width:800px; margin:0 auto;">
                <div style="font-size:48px; margin-bottom:24px;">ðŸŽ“</div>
                <div style="font-size:28px; font-weight:900; color:#60a5fa; margin-bottom:16px;">
                    AI DIAGNOSTIC REPORT
                </div>
                <div style="font-size:16px; font-weight:700; color:#cbd5e1; margin-bottom:32px;">
                    ${p.name} â€¢ ${p.case}
                </div>
                
                <div style="background:rgba(96,165,250,0.08); border:1px solid rgba(96,165,250,0.3); border-radius:16px; padding:32px; margin-bottom:24px;">
                    <div style="font-size:18px; font-weight:800; color:#60a5fa; margin-bottom:16px;">
                        Health Sovereignty Score
                    </div>
                    <div style="font-size:72px; font-weight:900; color:#60a5fa; margin-bottom:8px;">
                        ${gccData.score}%
                    </div>
                    <div style="font-size:14px; color:#cbd5e1;">
                        ${gccData.status}
                    </div>
                </div>
                
                <div style="font-size:14px; color:#94a3b8; line-height:1.8; margin-bottom:32px;">
                    Comprehensive AI-powered diagnostic synthesis integrating all 6 analytical layers:<br>
                    Clinical Data Lake â€¢ Inflammation Analysis â€¢ Sentinel Detection â€¢ Cohort Predictions â€¢ Handshake Pathways â€¢ Advanced Analytics
                </div>
                
                <div style="background:rgba(167,139,250,0.08); border:1px solid rgba(167,139,250,0.3); border-radius:12px; padding:24px;">
                    <div style="font-size:13px; font-weight:700; color:#a78bfa; margin-bottom:12px;">
                        ðŸ“Š COMING IN PRODUCTION VERSION
                    </div>
                    <div style="font-size:12px; color:#cbd5e1; line-height:1.6;">
                        â€¢ Personalized risk assessment with actionable recommendations<br>
                        â€¢ Multi-system health interpretation in plain language<br>
                        â€¢ Prioritized intervention timeline with expected outcomes<br>
                        â€¢ Longitudinal tracking and progress monitoring
                    </div>
                </div>
            </div>
        `;
    }


    window.onload=init;
    </script>
</body>
</html>
